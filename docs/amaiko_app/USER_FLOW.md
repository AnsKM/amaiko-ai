# USER_FLOW.md - User Flow Documentation

**Version:** 1.0
**Last Updated:** November 2025
**Application:** Amaiko AI - Enterprise AI Assistant

---

## Table of Contents

1. [Overview](#overview)
2. [Employee Onboarding Flow](#employee-onboarding-flow)
3. [Daily Usage Scenarios](#daily-usage-scenarios)
4. [Email Automation Flows](#email-automation-flows)
5. [Calendar Management Flows](#calendar-management-flows)
6. [Document Search Flows](#document-search-flows)
7. [Meeting Summary Flows](#meeting-summary-flows)
8. [Knowledge Base Interaction Flows](#knowledge-base-interaction-flows)
9. [Workflow Automation Flows](#workflow-automation-flows)
10. [Error Handling and Recovery Flows](#error-handling-and-recovery-flows)
11. [Multi-Agent Collaboration Flows](#multi-agent-collaboration-flows)
12. [Proactive Assistance Flows](#proactive-assistance-flows)

---

## Overview

This document describes the comprehensive user flows for the Amaiko AI enterprise assistant application. Each flow describes the step-by-step interaction between users and the AI assistant through Microsoft Teams, including authentication, tool usage, multi-agent collaboration, and error handling.

### Key User Interaction Patterns

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Interaction Types                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Direct Commands    â†’ Explicit user instructions         â”‚
â”‚  2. Natural Language   â†’ Conversational requests            â”‚
â”‚  3. Proactive Alerts   â†’ System-initiated notifications     â”‚
â”‚  4. Workflow Triggers  â†’ Multi-step automated processes     â”‚
â”‚  5. Knowledge Queries  â†’ Information retrieval requests     â”‚
â”‚  6. Context-aware      â†’ Implicit intent recognition        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### User Journey Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚      â”‚              â”‚      â”‚              â”‚
â”‚  Onboarding  â”‚â”€â”€â”€â”€â”€â–¶â”‚ Daily Usage  â”‚â”€â”€â”€â”€â”€â–¶â”‚   Advanced   â”‚
â”‚              â”‚      â”‚              â”‚      â”‚   Features   â”‚
â”‚              â”‚      â”‚              â”‚      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚                     â”‚
       â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - First loginâ”‚      â”‚ - Email help â”‚      â”‚ - Workflows  â”‚
â”‚ - Auth setup â”‚      â”‚ - Calendar   â”‚      â”‚ - Multi-agentâ”‚
â”‚ - Tutorial   â”‚      â”‚ - Search docsâ”‚      â”‚ - Analytics  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Employee Onboarding Flow

### Flow 1.1: First-Time User Setup

**Objective:** Set up new employee with Amaiko AI assistant and establish authentication.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  installs   â”‚
â”‚ Teams App   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Initial Welcome Message                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘  ğŸ‘‹ Welcome to Amaiko AI!                          â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  I'm your personal AI assistant for Microsoft 365  â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  I can help you with:                              â•‘ â”‚
â”‚  â•‘  â€¢ Email management                                â•‘ â”‚
â”‚  â•‘  â€¢ Calendar scheduling                             â•‘ â”‚
â”‚  â•‘  â€¢ Document search                                 â•‘ â”‚
â”‚  â•‘  â€¢ Meeting summaries                               â•‘ â”‚
â”‚  â•‘  â€¢ Knowledge base queries                          â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  [Get Started] [Learn More]                        â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Get Started"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Authentication Setup                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘  ğŸ” Connect Your Microsoft Account                 â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  To access your emails, calendar, and files,       â•‘ â”‚
â”‚  â•‘  please sign in with your Microsoft account.       â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  Permissions needed:                               â•‘ â”‚
â”‚  â•‘  âœ“ Read and manage emails                          â•‘ â”‚
â”‚  â•‘  âœ“ Access calendar                                 â•‘ â”‚
â”‚  â•‘  âœ“ Search files in OneDrive/SharePoint             â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  [Sign In with Microsoft] [Learn About Security]   â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Sign In"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Azure AD OAuth 2.0 Flow                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. User is redirected to Azure AD login page           â”‚
â”‚  2. User enters Microsoft 365 credentials               â”‚
â”‚  3. Consent screen displays requested permissions       â”‚
â”‚  4. User grants consent                                 â”‚
â”‚  5. Azure AD returns authorization code                 â”‚
â”‚  6. Backend exchanges code for access token             â”‚
â”‚  7. Token stored securely in agent mapping              â”‚
â”‚                                                         â”‚
â”‚  [Backend Process Flow]                                 â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ User grants â”‚                                        â”‚
â”‚  â”‚   consent   â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â”‚                                               â”‚
â”‚         â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ AgentService.createUserAgent()  â”‚                    â”‚
â”‚  â”‚                                 â”‚                    â”‚
â”‚  â”‚ 1. Create Letta agent           â”‚                    â”‚
â”‚  â”‚ 2. Initialize memory blocks     â”‚                    â”‚
â”‚  â”‚ 3. Save agent mapping to DB     â”‚                    â”‚
â”‚  â”‚ 4. Register user preferences    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Agent created successfully
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Personalization Setup                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘  âœ… You're all set!                                â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  Let me learn a bit about you to provide better    â•‘ â”‚
â”‚  â•‘  assistance:                                       â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  1. What's your role?                              â•‘ â”‚
â”‚  â•‘     [Sales] [Engineering] [Marketing] [Other]      â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  2. What's your typical work schedule?             â•‘ â”‚
â”‚  â•‘     [9-5] [Flexible] [Remote]                      â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  3. What matters most to you?                      â•‘ â”‚
â”‚  â•‘     [ ] Inbox zero                                 â•‘ â”‚
â”‚  â•‘     [ ] Meeting efficiency                         â•‘ â”‚
â”‚  â•‘     [ ] Quick document access                      â•‘ â”‚
â”‚  â•‘                                                    â•‘ â”‚
â”‚  â•‘  [Skip] [Continue]                                 â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User provides preferences
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Memory Block Initialization                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Backend: AgentMemoryService.updateAgentMetadata()      â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Persona Memory Block                    â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ name: "Amaiko Assistant"                â”‚            â”‚
â”‚  â”‚ role: "Professional AI Assistant"       â”‚            â”‚
â”‚  â”‚ tone: "Professional, friendly, helpful" â”‚            â”‚
â”‚  â”‚ capabilities: [...]                     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Human Memory Block                      â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ name: "John Doe"                        â”‚            â”‚
â”‚  â”‚ role: "Sales Manager"                   â”‚            â”‚
â”‚  â”‚ department: "Sales"                     â”‚            â”‚
â”‚  â”‚ preferences: {                          â”‚            â”‚
â”‚  â”‚   workSchedule: "9-5",                  â”‚            â”‚
â”‚  â”‚   priorities: ["inbox_zero"]            â”‚            â”‚
â”‚  â”‚ }                                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Preferences saved
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Interactive Tutorial                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“ Quick Tutorial                                â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Try these commands to get started:               â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  1ï¸âƒ£ "Search my recent emails"                     â•‘  â”‚
â”‚  â•‘     â†’ Finds emails from the past week             â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  2ï¸âƒ£ "What's on my calendar today?"                â•‘  â”‚
â”‚  â•‘     â†’ Shows today's meetings                      â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  3ï¸âƒ£ "Find documents about Q4 planning"            â•‘  â”‚
â”‚  â•‘     â†’ Searches OneDrive and SharePoint            â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Or just chat naturally - I understand context!   â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Try Command 1] [Try Command 2] [Start Using]    â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User selects "Start Using"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Onboarding Complete                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ‰ You're ready to go!                           â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I'm here to help anytime. Just type a message    â•‘  â”‚
â”‚  â•‘  or use the menu for quick commands.              â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ’¡ Pro tip: I learn from our conversations,      â•‘  â”‚
â”‚  â•‘  so I'll get better at helping you over time!     â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [View Help] [Dismiss]                            â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/agent.service.ts
async createUserAgent(userId: string, userProfile: any): Promise<string> {
  // 1. Create Letta agent with initial configuration
  const agent = await this.lettaClient.createAgent({
    name: `agent-${userId}`,
    memory: {
      persona: this.buildPersonaMemory(),
      human: this.buildHumanMemory(userProfile),
      conversationContext: '',
      archival: [],
    },
    tools: this.getAvailableTools(),
    model: 'gpt-4o',
    contextWindow: 128000,
  });

  // 2. Save agent mapping to database
  await this.agentMemoryService.saveAgentMapping({
    userId,
    agentId: agent.id,
    metadata: {
      createdAt: new Date(),
      userProfile,
      preferences: {},
    },
  });

  // 3. Return agent ID
  return agent.id;
}
```

**Database Records Created:**

```sql
-- agent_mappings table
INSERT INTO agent_mappings (id, user_id, agent_id, metadata, created_at)
VALUES (
  'uuid-1',
  'user-123',
  'letta-agent-456',
  '{
    "userProfile": {"name": "John Doe", "role": "Sales Manager"},
    "preferences": {"workSchedule": "9-5", "priorities": ["inbox_zero"]}
  }',
  '2025-11-03 10:00:00'
);
```

---

### Flow 1.2: Returning User Login

**Objective:** Authenticate returning user and restore agent context.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚ opens Teams â”‚
â”‚     App     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Check Existing Agent Mapping                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Backend: AgentMemoryService.getAgentId(userId)         â”‚
â”‚                                                         â”‚
â”‚  Query: SELECT agent_id FROM agent_mappings             â”‚
â”‚         WHERE user_id = 'user-123'                      â”‚
â”‚                                                         â”‚
â”‚  Result:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ agent_id: 'letta-agent-456'     â”‚                    â”‚
â”‚  â”‚ status: 'active'                â”‚                    â”‚
â”‚  â”‚ last_active: '2025-11-02'       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Agent found
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Token Validation                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Check if user's Microsoft Graph token is valid:        â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Token Status Check                     â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ IF token.expiresAt > Date.now()        â”‚             â”‚
â”‚  â”‚    â†’ Token valid, proceed              â”‚             â”‚
â”‚  â”‚ ELSE IF token.refreshToken exists      â”‚             â”‚
â”‚  â”‚    â†’ Refresh token automatically       â”‚             â”‚
â”‚  â”‚ ELSE                                   â”‚             â”‚
â”‚  â”‚    â†’ Prompt user to re-authenticate    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Token valid
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Load Agent Context                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Backend: Load agent's memory blocks from Letta         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Memory Blocks Loaded                    â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ â€¢ Persona: Assistant personality        â”‚            â”‚
â”‚  â”‚ â€¢ Human: User profile and preferences   â”‚            â”‚
â”‚  â”‚ â€¢ Conversation: Recent chat history     â”‚            â”‚
â”‚  â”‚ â€¢ Archival: Long-term knowledge (5 msgs)â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Context loaded
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Welcome Back Message                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ‘‹ Welcome back, John!                           â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“… You have 3 meetings today                     â•‘  â”‚
â”‚  â•‘  ğŸ“§ 5 unread emails in your inbox                 â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  What would you like to focus on first?           â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Check Calendar] [Review Emails] [Continue Chat] â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/agent-memory.service.ts
async getAgentId(userId: string): Promise<string | null> {
  const mapping = await this.agentMappingRepository.findOne({
    where: { userId, isActive: true },
  });

  if (!mapping) {
    return null;
  }

  // Check if agent still exists in Letta
  try {
    await this.lettaClient.getAgent(mapping.agentId);
    return mapping.agentId;
  } catch (error) {
    // Agent doesn't exist, deactivate mapping
    mapping.isActive = false;
    await this.agentMappingRepository.save(mapping);
    return null;
  }
}
```

---

## Daily Usage Scenarios

### Flow 2.1: Morning Briefing

**Objective:** Provide user with daily summary of emails, calendar, and tasks.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚ types "good â”‚
â”‚  morning"   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Intent Recognition                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Letta Agent analyzes user message:                     â”‚
â”‚                                                         â”‚
â”‚  Input: "good morning"                                  â”‚
â”‚  Intent: DAILY_BRIEFING                                 â”‚
â”‚  Confidence: 0.95                                       â”‚
â”‚  Required Tools: [                                      â”‚
â”‚    'get_calendar_events',                               â”‚
â”‚    'search_emails',                                     â”‚
â”‚    'get_user_profile'                                   â”‚
â”‚  ]                                                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Intent identified
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Parallel Tool Execution                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent executes multiple tools concurrently:            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Tool 1: get_calendar_events         â”‚                â”‚
â”‚  â”‚ Params: {                           â”‚                â”‚
â”‚  â”‚   startDate: "2025-11-03",          â”‚                â”‚
â”‚  â”‚   endDate: "2025-11-03"             â”‚                â”‚
â”‚  â”‚ }                                   â”‚                â”‚
â”‚  â”‚ Status: âœ“ Complete (250ms)          â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Tool 2: search_emails               â”‚                â”‚
â”‚  â”‚ Params: {                           â”‚                â”‚
â”‚  â”‚   query: "unread",                  â”‚                â”‚
â”‚  â”‚   maxResults: 10                    â”‚                â”‚
â”‚  â”‚ }                                   â”‚                â”‚
â”‚  â”‚ Status: âœ“ Complete (180ms)          â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Tool 3: get_user_profile            â”‚                â”‚
â”‚  â”‚ Params: {}                          â”‚                â”‚
â”‚  â”‚ Status: âœ“ Complete (120ms)          â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                         â”‚
â”‚  Total Time: 450ms (parallel execution)                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ All tools complete
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Response Synthesis                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent synthesizes results into coherent response:      â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  Good morning, John! â˜€ï¸                           â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Here's your daily briefing:                      â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“… CALENDAR (3 events today)                     â•‘  â”‚
â”‚  â•‘  â€¢ 9:00 AM - Team Standup (30 min)                â•‘  â”‚
â”‚  â•‘  â€¢ 11:00 AM - Client Demo - Acme Corp (1 hr)      â•‘  â”‚
â”‚  â•‘  â€¢ 2:00 PM - Sprint Planning (2 hrs)              â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“§ INBOX (5 unread emails)                       â•‘  â”‚
â”‚  â•‘  â€¢ Sarah: Q4 Budget Review - URGENT               â•‘  â”‚
â”‚  â•‘  â€¢ Mike: Follow-up from yesterday's meeting       â•‘  â”‚
â”‚  â•‘  â€¢ HR: Benefits enrollment deadline approaching   â•‘  â”‚
â”‚  â•‘  â€¢ ... and 2 more                                 â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ’¡ SUGGESTIONS                                   â•‘  â”‚
â”‚  â•‘  â€¢ You might want to review Sarah's budget email  â•‘  â”‚
â”‚  â•‘    before the 11 AM client demo                   â•‘  â”‚
â”‚  â•‘  â€¢ Your client demo materials are in the folder   â•‘  â”‚
â”‚  â•‘    "Q4-Demos" in OneDrive                         â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Review Urgent Emails] [Check Demo Materials]    â•‘  â”‚
â”‚  â•‘  [View Full Calendar]                             â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Review Urgent Emails"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Follow-up Action                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent executes search_emails with filter:              â”‚
â”‚                                                         â”‚
â”‚  Params: {                                              â”‚
â”‚    query: "from:sarah urgent",                          â”‚
â”‚    maxResults: 5                                        â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“§ Email from Sarah Johnson                      â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  From: sarah.johnson@company.com                  â•‘  â”‚
â”‚  â•‘  Subject: Q4 Budget Review - URGENT               â•‘  â”‚
â”‚  â•‘  Received: 8:45 AM                                â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Hi John,                                         â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  We need to finalize Q4 budget allocations        â•‘  â”‚
â”‚  â•‘  before today's client demo. Can you review       â•‘  â”‚
â”‚  â•‘  the attached spreadsheet and confirm by 10 AM?   â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Thanks,                                          â•‘  â”‚
â”‚  â•‘  Sarah                                            â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“ Attachment: Q4-Budget-Draft.xlsx              â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Reply] [Download Attachment] [Mark as Read]     â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/agent.service.ts
async handleDailyBriefing(
  userId: string,
  context: McpContext,
): Promise<string> {
  // Execute tools in parallel for faster response
  const [calendarEvents, unreadEmails, userProfile] = await Promise.all([
    this.executeTool('get_calendar_events', {
      startDate: new Date().toISOString().split('T')[0],
      endDate: new Date().toISOString().split('T')[0],
    }, context),
    this.executeTool('search_emails', {
      query: 'unread',
      maxResults: 10,
    }, context),
    this.graphService.getUserProfile(context.userToken),
  ]);

  // Synthesize briefing response
  const briefing = {
    greeting: `Good morning, ${userProfile.displayName}!`,
    calendar: this.formatCalendarSummary(calendarEvents),
    inbox: this.formatEmailSummary(unreadEmails),
    suggestions: this.generateSmartSuggestions(calendarEvents, unreadEmails),
  };

  return this.formatBriefingResponse(briefing);
}
```

---

### Flow 2.2: Quick Email Check

**Objective:** Search and retrieve specific emails quickly.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚ types query â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Show me emails from Sarah about budget"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Query Parsing                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Letta Agent extracts search parameters:                â”‚
â”‚                                                         â”‚
â”‚  Raw Input: "Show me emails from Sarah about budget"    â”‚
â”‚                                                         â”‚
â”‚  Parsed Parameters:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ sender: "Sarah"                     â”‚                â”‚
â”‚  â”‚ keywords: ["budget"]                â”‚                â”‚
â”‚  â”‚ timeframe: null (default: 30 days)  â”‚                â”‚
â”‚  â”‚ folder: null (default: all)         â”‚                â”‚
â”‚  â”‚ maxResults: 10 (default)            â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                         â”‚
â”‚  Tool Selected: search_emails                           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Microsoft Graph API Query                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Backend constructs Graph API query:                    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ GraphService.searchEmails()                    â”‚     â”‚
â”‚  â”‚                                                â”‚     â”‚
â”‚  â”‚ Graph API Request:                             â”‚     â”‚
â”‚  â”‚ GET /me/messages                               â”‚     â”‚
â”‚  â”‚ $filter=from/emailAddress/name eq 'Sarah'      â”‚     â”‚
â”‚  â”‚   AND contains(subject,'budget')               â”‚     â”‚
â”‚  â”‚ $orderby=receivedDateTime desc                 â”‚     â”‚
â”‚  â”‚ $top=10                                        â”‚     â”‚
â”‚  â”‚ $select=id,subject,from,receivedDateTime,      â”‚     â”‚
â”‚  â”‚         bodyPreview,hasAttachments             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚  Response Time: 280ms                                   â”‚
â”‚  Results Found: 3 emails                                â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Results Display                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“§ Found 3 emails from Sarah about budget        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â”‚
â”‚  â•‘  â”‚ 1. Q4 Budget Review - URGENT                 â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    From: Sarah Johnson                       â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    Date: Nov 3, 2025 8:45 AM                 â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    ğŸ“ Attachment: Q4-Budget-Draft.xlsx       â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    We need to finalize Q4 budget allocations â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    before today's client demo...             â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    [Read Full Email] [Reply] [Forward]       â”‚ â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â”‚
â”‚  â•‘  â”‚ 2. Budget Planning Meeting Notes             â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    From: Sarah Johnson                       â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    Date: Nov 1, 2025 3:20 PM                 â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    Here are the notes from our budget        â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    planning meeting...                       â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    [Read Full Email] [Reply] [Forward]       â”‚ â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â”‚
â”‚  â•‘  â”‚ 3. FW: Budget Approval Process               â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    From: Sarah Johnson                       â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    Date: Oct 28, 2025 10:15 AM               â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    Forwarding the budget approval process... â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚    [Read Full Email] [Reply] [Forward]       â”‚ â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Refine Search] [Open in Outlook]                â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Read Full Email"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Email Details View                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Tool: get_email                                        â”‚
â”‚  Params: { emailId: "email-id-123" }                    â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“§ Q4 Budget Review - URGENT                     â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  From: Sarah Johnson <sarah.johnson@company.com>  â•‘  â”‚
â”‚  â•‘  To: John Doe <john.doe@company.com>              â•‘  â”‚
â”‚  â•‘  CC: Mike Williams <mike.w@company.com>           â•‘  â”‚
â”‚  â•‘  Date: November 3, 2025 8:45 AM                   â•‘  â”‚
â”‚  â•‘  Importance: High                                 â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Hi John,                                         â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  We need to finalize Q4 budget allocations        â•‘  â”‚
â”‚  â•‘  before today's client demo with Acme Corp.       â•‘  â”‚
â”‚  â•‘  Can you review the attached spreadsheet and      â•‘  â”‚
â”‚  â•‘  confirm by 10 AM?                                â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Key changes from last version:                   â•‘  â”‚
â”‚  â•‘  â€¢ Marketing budget increased by 15%              â•‘  â”‚
â”‚  â•‘  â€¢ Engineering headcount adjusted                 â•‘  â”‚
â”‚  â•‘  â€¢ New product development allocation added       â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Let me know if you have questions.               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Thanks,                                          â•‘  â”‚
â”‚  â•‘  Sarah                                            â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“ Attachments:                                  â•‘  â”‚
â”‚  â•‘  â€¢ Q4-Budget-Draft.xlsx (245 KB)                 â•‘  â”‚
â”‚  â•‘    [Download] [Preview]                          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [Reply] [Reply All] [Forward] [Archive]          â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/mcp/tools/email-tools.service.ts
async searchEmails(
  params: SearchEmailsParams,
  context: McpContext,
): Promise<McpToolResult> {
  try {
    // Build Graph API filter
    let filter = '';
    if (params.sender) {
      filter += `from/emailAddress/name eq '${params.sender}'`;
    }
    if (params.keywords && params.keywords.length > 0) {
      const keywordFilter = params.keywords
        .map(k => `contains(subject,'${k}')`)
        .join(' OR ');
      filter += filter ? ` AND (${keywordFilter})` : keywordFilter;
    }

    // Execute search
    const emails = await this.graphService.searchEmails(
      context.userToken,
      {
        filter,
        maxResults: params.maxResults || 10,
        orderBy: 'receivedDateTime desc',
      },
    );

    // Format results
    return {
      content: [{
        type: 'text',
        text: JSON.stringify({
          status: 'success',
          count: emails.length,
          emails: emails.map(e => ({
            id: e.id,
            subject: e.subject,
            from: e.from?.emailAddress,
            receivedDateTime: e.receivedDateTime,
            bodyPreview: e.bodyPreview,
            hasAttachments: e.hasAttachments,
          })),
        }, null, 2),
      }],
    };
  } catch (error) {
    this.logger.error('Error searching emails', error);
    return {
      content: [{
        type: 'text',
        text: JSON.stringify({ status: 'error', message: error.message }),
      }],
      isError: true,
    };
  }
}
```

---

## Email Automation Flows

### Flow 3.1: Smart Email Reply

**Objective:** Draft contextual email responses using AI.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  selects    â”‚
â”‚   email     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ User: "Help me reply to this"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Email Context Analysis                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent retrieves full email content:                    â”‚
â”‚                                                         â”‚
â”‚  Tool: get_email                                        â”‚
â”‚  Params: { emailId: "email-id-123" }                    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Email Analysis                          â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ From: Sarah Johnson                     â”‚            â”‚
â”‚  â”‚ Subject: Q4 Budget Review - URGENT      â”‚            â”‚
â”‚  â”‚ Sentiment: Urgent, Professional         â”‚            â”‚
â”‚  â”‚ Action Required: Review & Confirm       â”‚            â”‚
â”‚  â”‚ Deadline: 10 AM (in 45 minutes)         â”‚            â”‚
â”‚  â”‚ Key Topics: ["budget", "demo", "Q4"]    â”‚            â”‚
â”‚  â”‚ Attachments: Yes (spreadsheet)          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Context Gathering                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent gathers relevant context:                        â”‚
â”‚                                                         â”‚
â”‚  1. Check user's calendar for conflicts:                â”‚
â”‚     Tool: get_calendar_events                           â”‚
â”‚     Result: 11 AM client demo with Acme Corp            â”‚
â”‚                                                         â”‚
â”‚  2. Search for related emails:                          â”‚
â”‚     Tool: search_emails                                 â”‚
â”‚     Query: "subject:budget from:sarah"                  â”‚
â”‚     Result: 2 previous emails in thread                 â”‚
â”‚                                                         â”‚
â”‚  3. Check knowledge base:                               â”‚
â”‚     Tool: search_knowledge_base                         â”‚
â”‚     Query: "Q4 budget approval process"                 â”‚
â”‚     Result: Budget approval workflow doc                â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Draft Reply Generation                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent generates contextual reply:                      â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ’¬ Draft Reply                                   â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I've drafted a response based on:                â•‘  â”‚
â”‚  â•‘  â€¢ The email content and urgency                  â•‘  â”‚
â”‚  â•‘  â€¢ Your upcoming demo at 11 AM                    â•‘  â”‚
â”‚  â•‘  â€¢ Previous budget discussions                    â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Hi Sarah,                                        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Thanks for sending this over. I'm reviewing the  â•‘  â”‚
â”‚  â•‘  Q4 budget spreadsheet now and will have          â•‘  â”‚
â”‚  â•‘  feedback by 10 AM as requested.                  â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Quick question on the marketing budget increase: â•‘  â”‚
â”‚  â•‘  Is this aligned with the product launch timeline â•‘  â”‚
â”‚  â•‘  we discussed last week?                          â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I'll incorporate any final changes before our    â•‘  â”‚
â”‚  â•‘  client demo at 11 AM.                            â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Best,                                            â•‘  â”‚
â”‚  â•‘  John                                             â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Send Now] [Edit Draft] [Add CC] [Discard]       â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Edit Draft"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Interactive Editing                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  User provides feedback:                                â”‚
â”‚  "Make it shorter and remove the question"              â”‚
â”‚                                                         â”‚
â”‚  Agent refines draft:                                   â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ’¬ Revised Draft                                 â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Hi Sarah,                                        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Thanks for sending this. I'm reviewing the Q4    â•‘  â”‚
â”‚  â•‘  budget now and will confirm by 10 AM.            â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Best,                                            â•‘  â”‚
â”‚  â•‘  John                                             â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Send Now] [Edit Again] [Discard]                â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Send Now"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Send Email                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Tool: reply_to_email                                   â”‚
â”‚  Params: {                                              â”‚
â”‚    emailId: "email-id-123",                             â”‚
â”‚    replyText: "Hi Sarah,\n\nThanks for sending..."      â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  Microsoft Graph API:                                   â”‚
â”‚  POST /me/messages/{id}/reply                           â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  âœ… Email sent successfully!                      â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Your reply has been sent to Sarah Johnson.       â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I've also:                                       â•‘  â”‚
â”‚  â•‘  â€¢ Marked the original email as read              â•‘  â”‚
â”‚  â•‘  â€¢ Added a reminder to follow up at 10 AM         â•‘  â”‚
â”‚  â•‘  â€¢ Saved the budget attachment to your OneDrive   â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Dismiss] [View Sent Email]                      â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/agent.service.ts
async generateEmailReply(
  emailId: string,
  context: McpContext,
): Promise<string> {
  // 1. Get email content
  const email = await this.executeTool('get_email', { emailId }, context);

  // 2. Gather related context
  const [relatedEmails, userCalendar, knowledgeBase] = await Promise.all([
    this.executeTool('search_emails', {
      query: `subject:${email.subject.split(' ')[0]}`,
      maxResults: 3,
    }, context),
    this.executeTool('get_calendar_events', {
      startDate: new Date().toISOString(),
      endDate: new Date(Date.now() + 86400000).toISOString(),
    }, context),
    this.searchKnowledgeBase(email.subject),
  ]);

  // 3. Build context for LLM
  const llmContext = {
    email,
    relatedEmails,
    userCalendar,
    knowledgeBase,
    userPreferences: this.getUserPreferences(context.userId),
  };

  // 4. Generate reply using GPT-4o
  const reply = await this.lettaClient.sendMessage(
    this.getAgentId(context.userId),
    {
      role: 'user',
      content: `Generate a professional email reply to this email: ${JSON.stringify(llmContext)}`,
    },
  );

  return reply.content;
}
```

---

### Flow 3.2: Email Categorization and Auto-filing

**Objective:** Automatically categorize and file emails based on content.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   System    â”‚
â”‚  monitors   â”‚
â”‚   inbox     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ New email arrives
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Email Received Event                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Microsoft Graph webhook notification:                  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Webhook Payload                         â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ resourceType: "message"                 â”‚            â”‚
â”‚  â”‚ changeType: "created"                   â”‚            â”‚
â”‚  â”‚ userId: "user-123"                      â”‚            â”‚
â”‚  â”‚ messageId: "msg-789"                    â”‚            â”‚
â”‚  â”‚ timestamp: "2025-11-03T10:30:00Z"       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Content Analysis                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent retrieves and analyzes email:                    â”‚
â”‚                                                         â”‚
â”‚  Tool: get_email                                        â”‚
â”‚  Params: { emailId: "msg-789" }                         â”‚
â”‚                                                         â”‚
â”‚  Email Content:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ From: recruiter@techcorp.com            â”‚            â”‚
â”‚  â”‚ Subject: Follow-up: Software Engineer   â”‚            â”‚
â”‚  â”‚          Position                       â”‚            â”‚
â”‚  â”‚ Body: "Thank you for applying to the    â”‚            â”‚
â”‚  â”‚        Software Engineer position at    â”‚            â”‚
â”‚  â”‚        TechCorp..."                     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  AI Classification:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Category: "Recruitment"                 â”‚            â”‚
â”‚  â”‚ Confidence: 0.92                        â”‚            â”‚
â”‚  â”‚ Priority: "Medium"                      â”‚            â”‚
â”‚  â”‚ Action Required: "Response expected"    â”‚            â”‚
â”‚  â”‚ Sentiment: "Positive"                   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Category Decision                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Check user's folder structure:                         â”‚
â”‚                                                         â”‚
â”‚  Existing Folders:                                      â”‚
â”‚  â€¢ Inbox                                                â”‚
â”‚  â€¢ Sent Items                                           â”‚
â”‚  â€¢ Archive                                              â”‚
â”‚  â€¢ Job Opportunities â† MATCH                            â”‚
â”‚  â€¢ Projects                                             â”‚
â”‚  â€¢ Personal                                             â”‚
â”‚                                                         â”‚
â”‚  Decision: Move to "Job Opportunities" folder           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Apply Labels and Move                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Tool: apply_email_labels                               â”‚
â”‚  Params: {                                              â”‚
â”‚    emailId: "msg-789",                                  â”‚
â”‚    labels: ["Recruitment", "Action Required"],          â”‚
â”‚    folder: "Job Opportunities"                          â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  Microsoft Graph API operations:                        â”‚
â”‚  1. POST /me/messages/{id}/move                         â”‚
â”‚     { destinationId: "folder-job-opps" }                â”‚
â”‚  2. PATCH /me/messages/{id}                             â”‚
â”‚     { categories: ["Recruitment"] }                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: User Notification (Optional)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  If email is high priority, notify user:                â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“¬ New Email Organized                           â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I've filed a recruitment email for you:          â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  From: TechCorp Recruiter                         â•‘  â”‚
â”‚  â•‘  Subject: Follow-up: Software Engineer Position   â•‘  â”‚
â”‚  â•‘  Category: Recruitment                            â•‘  â”‚
â”‚  â•‘  Folder: Job Opportunities                        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  This looks like a follow-up to a job application.â•‘  â”‚
â”‚  â•‘  Would you like me to draft a response?           â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Draft Response] [View Email] [Dismiss]          â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/email-auto-categorizer.service.ts
@Injectable()
export class EmailAutoCategorizer {
  async categorizeEmail(emailId: string, userId: string): Promise<void> {
    // 1. Get email content
    const email = await this.graphService.getEmail(userToken, emailId);

    // 2. Classify using GPT-4o
    const classification = await this.classifyEmail(email);

    // 3. Determine target folder
    const targetFolder = await this.determineFolder(userId, classification);

    // 4. Move email and apply labels
    await this.graphService.moveEmail(userToken, emailId, targetFolder);
    await this.graphService.applyCategories(
      userToken,
      emailId,
      classification.categories,
    );

    // 5. Notify user if high priority
    if (classification.priority === 'high') {
      await this.notifyUser(userId, email, classification);
    }
  }

  private async classifyEmail(email: any): Promise<EmailClassification> {
    const prompt = `
      Classify this email into one of these categories:
      - Work: Project updates, meetings, internal communications
      - Recruitment: Job opportunities, interview requests
      - Personal: Personal emails, social notifications
      - Marketing: Newsletters, promotional emails
      - Financial: Invoices, payment confirmations
      - Other: Everything else

      Email:
      From: ${email.from}
      Subject: ${email.subject}
      Body: ${email.body}

      Return JSON: {
        "category": "...",
        "confidence": 0.0-1.0,
        "priority": "low|medium|high",
        "actionRequired": boolean
      }
    `;

    const response = await this.openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [{ role: 'user', content: prompt }],
      response_format: { type: 'json_object' },
    });

    return JSON.parse(response.choices[0].message.content);
  }
}
```

---

## Calendar Management Flows

### Flow 4.1: Smart Meeting Scheduling

**Objective:** Find optimal meeting times and create calendar events.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  requests   â”‚
â”‚  meeting    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Schedule a meeting with Sarah next week for 1 hour"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Intent Parsing                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent extracts meeting parameters:                     â”‚
â”‚                                                         â”‚
â”‚  Raw Input: "Schedule a meeting with Sarah next week    â”‚
â”‚              for 1 hour"                                â”‚
â”‚                                                         â”‚
â”‚  Parsed Parameters:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ attendees: ["Sarah Johnson"]            â”‚            â”‚
â”‚  â”‚ duration: 60 minutes                    â”‚            â”‚
â”‚  â”‚ timeframe: "next week" (Nov 4-8, 2025)  â”‚            â”‚
â”‚  â”‚ subject: null (to be determined)        â”‚            â”‚
â”‚  â”‚ isOnlineMeeting: null (ask user)        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Attendee Lookup                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Tool: search_people                                    â”‚
â”‚  Params: { query: "Sarah" }                             â”‚
â”‚                                                         â”‚
â”‚  Results:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ 1. Sarah Johnson                        â”‚            â”‚
â”‚  â”‚    Email: sarah.johnson@company.com     â”‚            â”‚
â”‚  â”‚    Department: Finance                  â”‚            â”‚
â”‚  â”‚    âœ“ Frequent contact                   â”‚            â”‚
â”‚  â”‚                                         â”‚            â”‚
â”‚  â”‚ 2. Sarah Williams                       â”‚            â”‚
â”‚  â”‚    Email: sarah.w@company.com           â”‚            â”‚
â”‚  â”‚    Department: HR                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  Agent selects: Sarah Johnson (based on context)        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Availability Check                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Tool: get_calendar_events (for both attendees)         â”‚
â”‚                                                         â”‚
â”‚  Params: {                                              â”‚
â”‚    startDate: "2025-11-04",                             â”‚
â”‚    endDate: "2025-11-08"                                â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  Availability Analysis:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          Mon 11/4  Tue 11/5  Wed 11/6  Thu 11/7  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 9-10 AM    âœ—         âœ—         âœ“         âœ“       â”‚   â”‚
â”‚  â”‚ 10-11 AM   âœ—         âœ“         âœ“         âœ—       â”‚   â”‚
â”‚  â”‚ 11-12 PM   âœ“         âœ—         âœ“         âœ“       â”‚   â”‚
â”‚  â”‚ 1-2 PM     âœ—         âœ—         âœ—         âœ“       â”‚   â”‚
â”‚  â”‚ 2-3 PM     âœ“         âœ“         âœ—         âœ“       â”‚   â”‚
â”‚  â”‚ 3-4 PM     âœ“         âœ“         âœ“         âœ—       â”‚   â”‚
â”‚  â”‚ 4-5 PM     âœ—         âœ—         âœ“         âœ“       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  Best Options (both available):                         â”‚
â”‚  1. Wednesday 11/6 at 9:00 AM                           â”‚
â”‚  2. Wednesday 11/6 at 11:00 AM                          â”‚
â”‚  3. Wednesday 11/6 at 3:00 PM                           â”‚
â”‚  4. Thursday 11/7 at 9:00 AM                            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Present Options to User                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“… Available Meeting Times                       â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I found several times when both you and Sarah    â•‘  â”‚
â”‚  â•‘  are available next week:                         â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â”‚
â”‚  â•‘  â”‚ Wednesday, November 6, 2025                  â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ â—‹ 9:00 AM - 10:00 AM (Recommended)           â”‚ â•‘  â”‚
â”‚  â•‘  â”‚   Early morning - both have no conflicts     â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ â—‹ 11:00 AM - 12:00 PM                        â”‚ â•‘  â”‚
â”‚  â•‘  â”‚   Mid-morning slot                           â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ â—‹ 3:00 PM - 4:00 PM                          â”‚ â•‘  â”‚
â”‚  â•‘  â”‚   Afternoon slot                             â”‚ â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â”‚
â”‚  â•‘  â”‚ Thursday, November 7, 2025                   â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ â—‹ 9:00 AM - 10:00 AM                         â”‚ â•‘  â”‚
â”‚  â•‘  â”‚   Early morning slot                         â”‚ â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  What's the meeting about?                        â•‘  â”‚
â”‚  â•‘  [Budget Review] [Project Update] [Other]         â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Should this be a Teams meeting?                  â•‘  â”‚
â”‚  â•‘  [Yes, online] [No, in-person] [Hybrid]           â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User selects options
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Create Calendar Event                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  User selections:                                       â”‚
â”‚  â€¢ Time: Wednesday 11/6 at 9:00 AM                      â”‚
â”‚  â€¢ Subject: Budget Review                               â”‚
â”‚  â€¢ Meeting Type: Teams meeting                          â”‚
â”‚                                                         â”‚
â”‚  Tool: create_calendar_event                            â”‚
â”‚  Params: {                                              â”‚
â”‚    subject: "Budget Review",                            â”‚
â”‚    startDateTime: "2025-11-06T09:00:00",                â”‚
â”‚    endDateTime: "2025-11-06T10:00:00",                  â”‚
â”‚    attendees: ["sarah.johnson@company.com"],            â”‚
â”‚    isOnlineMeeting: true,                               â”‚
â”‚    body: "Discussion about Q4 budget allocations"       â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  Microsoft Graph API:                                   â”‚
â”‚  POST /me/events                                        â”‚
â”‚  {                                                      â”‚
â”‚    "subject": "Budget Review",                          â”‚
â”‚    "start": { "dateTime": "2025-11-06T09:00:00" },      â”‚
â”‚    "end": { "dateTime": "2025-11-06T10:00:00" },        â”‚
â”‚    "attendees": [{                                      â”‚
â”‚      "emailAddress": {                                  â”‚
â”‚        "address": "sarah.johnson@company.com"           â”‚
â”‚      }                                                  â”‚
â”‚    }],                                                  â”‚
â”‚    "isOnlineMeeting": true                              â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Confirmation                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  âœ… Meeting Scheduled Successfully!               â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“… Budget Review                                 â•‘  â”‚
â”‚  â•‘  ğŸ• Wednesday, November 6, 2025                   â•‘  â”‚
â”‚  â•‘     9:00 AM - 10:00 AM                            â•‘  â”‚
â”‚  â•‘  ğŸ‘¤ Attendees:                                    â•‘  â”‚
â”‚  â•‘     â€¢ You (John Doe)                              â•‘  â”‚
â”‚  â•‘     â€¢ Sarah Johnson                               â•‘  â”‚
â”‚  â•‘  ğŸ’» Teams Meeting Link:                           â•‘  â”‚
â”‚  â•‘     [Join Meeting]                                â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“§ Calendar invitations sent to all attendees    â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ’¡ Reminder: You have a client demo at 11 AM     â•‘  â”‚
â”‚  â•‘     the same day. Want me to send prep materials? â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [View in Calendar] [Add Agenda] [Dismiss]        â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/meeting-scheduler.service.ts
@Injectable()
export class MeetingSchedulerService {
  async scheduleSmartMeeting(
    params: MeetingRequest,
    context: McpContext,
  ): Promise<CalendarEvent> {
    // 1. Resolve attendee emails
    const attendees = await this.resolveAttendees(
      params.attendees,
      context.userToken,
    );

    // 2. Find available time slots
    const availableSlots = await this.findAvailableSlots({
      attendees: [context.userEmail, ...attendees],
      duration: params.duration,
      dateRange: params.dateRange,
      userToken: context.userToken,
    });

    // 3. Rank slots by preference
    const rankedSlots = this.rankSlots(availableSlots, {
      preferMorning: true,
      avoidEndOfDay: true,
      minimizeGaps: true,
    });

    // 4. Present top options to user
    const selectedSlot = await this.presentOptionsToUser(rankedSlots);

    // 5. Create calendar event
    const event = await this.graphService.createCalendarEvent(
      context.userToken,
      {
        subject: params.subject,
        startDateTime: selectedSlot.start,
        endDateTime: selectedSlot.end,
        attendees,
        isOnlineMeeting: params.isOnlineMeeting,
        body: params.body,
      },
    );

    return event;
  }

  private async findAvailableSlots(params: {
    attendees: string[];
    duration: number;
    dateRange: { start: Date; end: Date };
    userToken: string;
  }): Promise<TimeSlot[]> {
    // Query Microsoft Graph Schedule API
    const scheduleResponse = await this.graphService.getSchedule({
      schedules: params.attendees,
      startTime: params.dateRange.start,
      endTime: params.dateRange.end,
      availabilityViewInterval: 30, // 30-minute slots
    });

    // Find overlapping free slots
    const freeSlots = this.findOverlappingFreeSlots(
      scheduleResponse,
      params.duration,
    );

    return freeSlots;
  }
}
```

---

### Flow 4.2: Meeting Preparation Assistant

**Objective:** Help users prepare for upcoming meetings with relevant context.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   System    â”‚
â”‚  proactive  â”‚
â”‚   alert     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 30 minutes before meeting
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Meeting Detection                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  System checks upcoming calendar events:                â”‚
â”‚                                                         â”‚
â”‚  Current Time: 10:30 AM                                 â”‚
â”‚  Next Meeting: 11:00 AM - Client Demo - Acme Corp       â”‚
â”‚  Time Until Meeting: 30 minutes                         â”‚
â”‚                                                         â”‚
â”‚  Trigger: Pre-meeting preparation alert                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Context Gathering                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent gathers meeting context:                         â”‚
â”‚                                                         â”‚
â”‚  1. Calendar Event Details:                             â”‚
â”‚     Tool: get_calendar_events                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚ Event ID: event-456                 â”‚             â”‚
â”‚     â”‚ Subject: Client Demo - Acme Corp    â”‚             â”‚
â”‚     â”‚ Start: 11:00 AM                     â”‚             â”‚
â”‚     â”‚ Duration: 1 hour                    â”‚             â”‚
â”‚     â”‚ Attendees: 5 people                 â”‚             â”‚
â”‚     â”‚ Online: Teams meeting               â”‚             â”‚
â”‚     â”‚ Organizer: John Doe                 â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                         â”‚
â”‚  2. Related Emails:                                     â”‚
â”‚     Tool: search_emails                                 â”‚
â”‚     Query: "from:acme subject:demo"                     â”‚
â”‚     Results: 3 emails found                             â”‚
â”‚                                                         â”‚
â”‚  3. Related Documents:                                  â”‚
â”‚     Tool: search_files                                  â”‚
â”‚     Query: "Acme Corp demo materials"                   â”‚
â”‚     Results: 2 PowerPoint files found                   â”‚
â”‚                                                         â”‚
â”‚  4. Previous Meeting Notes:                             â”‚
â”‚     Tool: search_knowledge_base                         â”‚
â”‚     Query: "Acme Corp previous meetings"                â”‚
â”‚     Results: 1 meeting summary from last month          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Preparation Summary                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent synthesizes preparation materials:               â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  â° Meeting in 30 Minutes                         â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“… Client Demo - Acme Corp                       â•‘  â”‚
â”‚  â•‘  ğŸ• 11:00 AM - 12:00 PM                           â•‘  â”‚
â”‚  â•‘  ğŸ’» [Join Teams Meeting]                          â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ‘¥ ATTENDEES (5)                                 â•‘  â”‚
â”‚  â•‘  â€¢ You (Host)                                     â•‘  â”‚
â”‚  â•‘  â€¢ Jane Smith (Acme Corp - CEO)                   â•‘  â”‚
â”‚  â•‘  â€¢ Bob Wilson (Acme Corp - CTO)                   â•‘  â”‚
â”‚  â•‘  â€¢ Sarah (Your Finance Lead)                      â•‘  â”‚
â”‚  â•‘  â€¢ Mike (Your Product Manager)                    â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“‹ QUICK BRIEF                                   â•‘  â”‚
â”‚  â•‘  â€¢ Purpose: Product demo for Q1 2026 planning     â•‘  â”‚
â”‚  â•‘  â€¢ Company: Acme Corp (Manufacturing)             â•‘  â”‚
â”‚  â•‘  â€¢ Last Contact: October 15, 2025                 â•‘  â”‚
â”‚  â•‘  â€¢ Deal Size: Estimated $250K annually            â•‘  â”‚
â”‚  â•‘  â€¢ Decision Maker: Jane Smith (CEO)               â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ” KEY CONTEXT                                   â•‘  â”‚
â”‚  â•‘  1. Previous Meeting (Oct 15):                    â•‘  â”‚
â”‚  â•‘     - Expressed interest in enterprise plan       â•‘  â”‚
â”‚  â•‘     - Concerned about integration with SAP        â•‘  â”‚
â”‚  â•‘     - Wanted to see reporting features            â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  2. Recent Email (Nov 1):                         â•‘  â”‚
â”‚  â•‘     Jane confirmed their Q1 budget is approved    â•‘  â”‚
â”‚  â•‘     and they want to move fast                    â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  3. Company Research:                             â•‘  â”‚
â”‚  â•‘     - 500 employees, 3 manufacturing facilities   â•‘  â”‚
â”‚  â•‘     - Currently using legacy system (5+ years old)â•‘  â”‚
â”‚  â•‘     - Expanding into European market              â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“ DEMO MATERIALS                                â•‘  â”‚
â”‚  â•‘  âœ“ Acme-Demo-Deck-v3.pptx (Last updated: Nov 2)   â•‘  â”‚
â”‚  â•‘  âœ“ SAP-Integration-Guide.pdf                      â•‘  â”‚
â”‚  â•‘  âœ— Demo environment - [Set Up Now]                â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ’¡ TALKING POINTS                                â•‘  â”‚
â”‚  â•‘  â€¢ Emphasize SAP integration capabilities         â•‘  â”‚
â”‚  â•‘  â€¢ Highlight advanced reporting dashboard         â•‘  â”‚
â”‚  â•‘  â€¢ Mention European data compliance (GDPR)        â•‘  â”‚
â”‚  â•‘  â€¢ Discuss implementation timeline (8-12 weeks)   â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â“ POTENTIAL QUESTIONS                           â•‘  â”‚
â”‚  â•‘  â€¢ What's the total cost of ownership?            â•‘  â”‚
â”‚  â•‘  â€¢ Can we do a pilot with one facility first?     â•‘  â”‚
â”‚  â•‘  â€¢ What support do you provide during migration?  â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Open Demo Deck] [View Previous Notes]           â•‘  â”‚
â”‚  â•‘  [Set Up Demo] [Add to Notes]                     â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Set Up Demo"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Interactive Preparation                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent guides setup:                                    â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ› ï¸ Demo Environment Setup                        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I'll help you set up the demo. Here's the        â•‘  â”‚
â”‚  â•‘  checklist:                                       â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  âœ“ Demo account created (Acme-Demo-2025)          â•‘  â”‚
â”‚  â•‘  âœ“ Sample data loaded (manufacturing scenario)    â•‘  â”‚
â”‚  â•‘  âœ“ SAP integration configured                     â•‘  â”‚
â”‚  â•‘  â³ Generating sample reports...                  â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Demo URL: https://demo.app.com/acme              â•‘  â”‚
â”‚  â•‘  Login: demo@acme.com                             â•‘  â”‚
â”‚  â•‘  Password: [Click to reveal]                      â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  I've also:                                       â•‘  â”‚
â”‚  â•‘  â€¢ Opened your demo deck in PowerPoint            â•‘  â”‚
â”‚  â•‘  â€¢ Pinned relevant docs to Teams meeting          â•‘  â”‚
â”‚  â•‘  â€¢ Created a real-time notes doc                  â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Ready to go! [Join Meeting Now] [Dismiss]        â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/meeting-prep.service.ts
@Injectable()
export class MeetingPrepService {
  @Cron('*/5 * * * *') // Check every 5 minutes
  async checkUpcomingMeetings(): Promise<void> {
    const users = await this.userRepository.find({ where: { isActive: true } });

    for (const user of users) {
      const upcomingMeetings = await this.getUpcomingMeetings(
        user.id,
        30, // 30 minutes
      );

      for (const meeting of upcomingMeetings) {
        // Check if we've already sent prep for this meeting
        if (!this.hasSentPrep(meeting.id)) {
          await this.sendMeetingPrep(user.id, meeting);
        }
      }
    }
  }

  async sendMeetingPrep(
    userId: string,
    meeting: CalendarEvent,
  ): Promise<void> {
    // 1. Gather context
    const context = await this.gatherMeetingContext(userId, meeting);

    // 2. Generate prep summary
    const prepSummary = await this.generatePrepSummary(meeting, context);

    // 3. Send proactive message
    await this.teamsService.sendProactiveMessage(userId, prepSummary);

    // 4. Mark as sent
    this.markPrepSent(meeting.id);
  }

  private async gatherMeetingContext(
    userId: string,
    meeting: CalendarEvent,
  ): Promise<MeetingContext> {
    const [emails, files, notes, companyInfo] = await Promise.all([
      // Search related emails
      this.executeTool('search_emails', {
        query: this.buildEmailQuery(meeting),
        maxResults: 10,
      }),
      // Search related files
      this.executeTool('search_files', {
        query: meeting.subject,
        maxResults: 5,
      }),
      // Search meeting notes
      this.searchKnowledgeBase(`previous meetings ${meeting.organizer}`),
      // Company research
      this.lookupCompanyInfo(meeting.attendees),
    ]);

    return {
      meeting,
      emails,
      files,
      notes,
      companyInfo,
    };
  }

  private async generatePrepSummary(
    meeting: CalendarEvent,
    context: MeetingContext,
  ): Promise<string> {
    const prompt = `
      Generate a concise meeting preparation summary based on:

      Meeting: ${JSON.stringify(meeting)}
      Context: ${JSON.stringify(context)}

      Include:
      1. Meeting overview
      2. Attendee information
      3. Key context from previous interactions
      4. Relevant documents and materials
      5. Suggested talking points
      6. Potential questions to prepare for

      Format as an adaptive card for Microsoft Teams.
    `;

    const response = await this.lettaClient.sendMessage(
      this.getAgentId(userId),
      prompt,
    );

    return response.content;
  }
}
```

---

## Document Search Flows

### Flow 5.1: Intelligent Document Search

**Objective:** Find documents across OneDrive and SharePoint using natural language.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  searches   â”‚
â”‚  documents  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Find the Q4 planning document I worked on last month"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Query Understanding                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent analyzes natural language query:                 â”‚
â”‚                                                         â”‚
â”‚  Raw Input: "Find the Q4 planning document I worked on  â”‚
â”‚              last month"                                â”‚
â”‚                                                         â”‚
â”‚  Extracted Parameters:                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ keywords: ["Q4", "planning"]            â”‚            â”‚
â”‚  â”‚ fileTypes: ["document"] (Word/PDF)      â”‚            â”‚
â”‚  â”‚ authorFilter: "me" (current user)       â”‚            â”‚
â”‚  â”‚ timeRange: "last month" (Oct 2025)      â”‚            â”‚
â”‚  â”‚ editFilter: "modified by me"            â”‚            â”‚
â”‚  â”‚ locations: ["OneDrive", "SharePoint"]   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  Search Strategy: Keyword + Metadata filtering          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Multi-Source Search                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent searches across multiple sources:                â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Source 1: OneDrive                       â”‚           â”‚
â”‚  â”‚                                          â”‚           â”‚
â”‚  â”‚ Tool: search_files                       â”‚           â”‚
â”‚  â”‚ Params: {                                â”‚           â”‚
â”‚  â”‚   query: "Q4 planning",                  â”‚           â”‚
â”‚  â”‚   filter: "lastModifiedBy eq 'me'",      â”‚           â”‚
â”‚  â”‚   dateRange: "2025-10-01:2025-10-31"     â”‚           â”‚
â”‚  â”‚ }                                        â”‚           â”‚
â”‚  â”‚ Results: 4 files found                   â”‚           â”‚
â”‚  â”‚ Status: âœ“ Complete (320ms)               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Source 2: SharePoint Sites              â”‚            â”‚
â”‚  â”‚                                         â”‚            â”‚
â”‚  â”‚ Tool: search_sharepoint                 â”‚            â”‚
â”‚  â”‚ Params: {                               â”‚            â”‚
â”‚  â”‚   query: "Q4 planning",                 â”‚            â”‚
â”‚  â”‚   sites: ["Team Site", "Finance"]       â”‚            â”‚
â”‚  â”‚ }                                       â”‚            â”‚
â”‚  â”‚ Results: 6 files found                  â”‚            â”‚
â”‚  â”‚ Status: âœ“ Complete (450ms)              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Source 3: Recent Files                  â”‚            â”‚
â”‚  â”‚                                         â”‚            â”‚
â”‚  â”‚ Tool: get_recent_files                  â”‚            â”‚
â”‚  â”‚ Params: { filter: "Q4" }                â”‚            â”‚
â”‚  â”‚ Results: 2 files found                  â”‚            â”‚
â”‚  â”‚ Status: âœ“ Complete (180ms)              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  Total Results: 12 files                                â”‚
â”‚  Deduplicated: 10 unique files                          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Relevance Ranking                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Agent ranks results by relevance:                      â”‚
â”‚                                                         â”‚
â”‚  Ranking Factors:                                       â”‚
â”‚  â€¢ Keyword match in title (weight: 0.3)                 â”‚
â”‚  â€¢ User is author/last editor (weight: 0.25)            â”‚
â”‚  â€¢ Recent modification date (weight: 0.2)               â”‚
â”‚  â€¢ File type preference (weight: 0.15)                  â”‚
â”‚  â€¢ Frequency of access (weight: 0.1)                    â”‚
â”‚                                                         â”‚
â”‚  Top Results:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 1. Q4-Strategic-Planning-Draft.docx        â”‚         â”‚
â”‚  â”‚    Score: 0.92                             â”‚         â”‚
â”‚  â”‚    Reason: Exact match, edited by you      â”‚         â”‚
â”‚  â”‚            last week                       â”‚         â”‚
â”‚  â”‚                                            â”‚         â”‚
â”‚  â”‚ 2. Q4_Planning_Meeting_Notes.docx          â”‚         â”‚
â”‚  â”‚    Score: 0.85                             â”‚         â”‚
â”‚  â”‚    Reason: Strong match, modified in Oct   â”‚         â”‚
â”‚  â”‚                                            â”‚         â”‚
â”‚  â”‚ 3. 2025-Q4-Budget-Plan.xlsx                â”‚         â”‚
â”‚  â”‚    Score: 0.78                             â”‚         â”‚
â”‚  â”‚    Reason: Related file, collaborative     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Present Results                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ” Found 10 documents matching "Q4 planning"     â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  â­ TOP MATCH                                     â•‘  â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â”‚
â”‚  â•‘  â”‚ ğŸ“„ Q4-Strategic-Planning-Draft.docx          â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ ğŸ“ OneDrive > Documents > Strategy           â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ âœï¸ Last edited by you on Oct 28, 2025        â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ ğŸ“ Size: 2.4 MB â€¢ 35 pages                   â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ This appears to be your main Q4 planning     â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ document with strategy and goals.            â”‚ â•‘  â”‚
â”‚  â•‘  â”‚                                              â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ [Open in Word] [Open in Browser]             â”‚ â•‘  â”‚
â”‚  â•‘  â”‚ [Share] [Download] [Show Location]           â”‚ â•‘  â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  OTHER RESULTS (9)                                â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“„ Q4_Planning_Meeting_Notes.docx                â•‘  â”‚
â”‚  â•‘     Last edited: Oct 25, 2025 â€¢ SharePoint        â•‘  â”‚
â”‚  â•‘     [Open]                                        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“Š 2025-Q4-Budget-Plan.xlsx                      â•‘  â”‚
â”‚  â•‘     Last edited: Oct 22, 2025 â€¢ Shared with 3     â•‘  â”‚
â”‚  â•‘     [Open]                                        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ“„ Q4-Objectives-Template.docx                   â•‘  â”‚
â”‚  â•‘     Last edited: Oct 15, 2025 â€¢ OneDrive          â•‘  â”‚
â”‚  â•‘     [Open]                                        â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Show All 9 Results] [Refine Search]             â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Open in Word"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Document Access                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Tool: get_file_download_info                           â”‚
â”‚  Params: { fileId: "file-789" }                         â”‚
â”‚                                                         â”‚
â”‚  Microsoft Graph API:                                   â”‚
â”‚  GET /me/drive/items/{fileId}                           â”‚
â”‚                                                         â”‚
â”‚  Response:                                              â”‚
â”‚  {                                                      â”‚
â”‚    "webUrl": "https://company.sharepoint.com/...",      â”‚
â”‚    "downloadUrl": "https://download.url...",            â”‚
â”‚    "name": "Q4-Strategic-Planning-Draft.docx",          â”‚
â”‚    "size": 2457600                                      â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸš€ Opening Document                              â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Q4-Strategic-Planning-Draft.docx                 â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  Opening in Microsoft Word...                     â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  ğŸ’¡ Tip: I can help you summarize this document   â•‘  â”‚
â”‚  â•‘  or extract key information. Just ask!            â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [Summarize Document] [Extract Action Items]      â•‘  â”‚
â”‚  â•‘  [Dismiss]                                        â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/mcp/tools/file-tools.service.ts
async searchFiles(
  params: SearchFilesParams,
  context: McpContext,
): Promise<McpToolResult> {
  try {
    // 1. Parse natural language query
    const searchParams = await this.parseSearchQuery(params.query);

    // 2. Build Graph API queries
    const driveQuery = this.buildDriveQuery(searchParams);
    const sharePointQuery = this.buildSharePointQuery(searchParams);

    // 3. Execute searches in parallel
    const [driveFiles, sharePointFiles, recentFiles] = await Promise.all([
      this.graphService.searchDrive(context.userToken, driveQuery),
      this.graphService.searchSharePoint(context.userToken, sharePointQuery),
      this.graphService.getRecentFiles(context.userToken, {
        filter: searchParams.keywords.join(' '),
      }),
    ]);

    // 4. Merge and deduplicate results
    const allFiles = this.mergeAndDeduplicate([
      ...driveFiles,
      ...sharePointFiles,
      ...recentFiles,
    ]);

    // 5. Rank by relevance
    const rankedFiles = this.rankFilesByRelevance(
      allFiles,
      searchParams,
      context.userId,
    );

    // 6. Return formatted results
    return {
      content: [{
        type: 'text',
        text: JSON.stringify({
          status: 'success',
          count: rankedFiles.length,
          files: rankedFiles.slice(0, 10).map(f => ({
            id: f.id,
            name: f.name,
            path: f.parentReference?.path,
            size: f.size,
            lastModifiedDateTime: f.lastModifiedDateTime,
            lastModifiedBy: f.lastModifiedBy?.user?.displayName,
            webUrl: f.webUrl,
            relevanceScore: f.relevanceScore,
          })),
        }, null, 2),
      }],
    };
  } catch (error) {
    this.logger.error('Error searching files', error);
    return {
      content: [{
        type: 'text',
        text: JSON.stringify({ status: 'error', message: error.message }),
      }],
      isError: true,
    };
  }
}

private rankFilesByRelevance(
  files: DriveItem[],
  searchParams: SearchParams,
  userId: string,
): (DriveItem & { relevanceScore: number })[] {
  return files.map(file => {
    let score = 0;

    // Title match (weight: 0.3)
    const titleMatch = searchParams.keywords.some(kw =>
      file.name.toLowerCase().includes(kw.toLowerCase()),
    );
    if (titleMatch) score += 0.3;

    // User is author/editor (weight: 0.25)
    if (file.lastModifiedBy?.user?.id === userId) score += 0.25;

    // Recent modification (weight: 0.2)
    const daysSinceModified = (Date.now() - new Date(file.lastModifiedDateTime).getTime()) / (1000 * 60 * 60 * 24);
    if (daysSinceModified < 7) score += 0.2;
    else if (daysSinceModified < 30) score += 0.15;
    else if (daysSinceModified < 90) score += 0.1;

    // File type preference (weight: 0.15)
    const preferredTypes = ['.docx', '.xlsx', '.pptx', '.pdf'];
    if (preferredTypes.some(ext => file.name.endsWith(ext))) score += 0.15;

    // Access frequency (weight: 0.1)
    // This would require tracking user access patterns
    // For now, use view count if available
    if (file.viewCount > 10) score += 0.1;

    return { ...file, relevanceScore: score };
  }).sort((a, b) => b.relevanceScore - a.relevanceScore);
}
```

---

### Flow 5.2: Document Summarization

**Objective:** Generate summaries of documents to help users quickly understand content.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚   requests  â”‚
â”‚  summary    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Summarize this document"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Document Retrieval                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Tool: get_file_download_info                            â”‚
â”‚  Params: { fileId: "file-789" }                          â”‚
â”‚                                                           â”‚
â”‚  Microsoft Graph API:                                    â”‚
â”‚  GET /me/drive/items/{fileId}/content                    â”‚
â”‚                                                           â”‚
â”‚  Document Details:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Name: Q4-Strategic-Planning-Draft.docx  â”‚            â”‚
â”‚  â”‚ Size: 2.4 MB (35 pages)                 â”‚            â”‚
â”‚  â”‚ Format: Microsoft Word                  â”‚            â”‚
â”‚  â”‚ Content: Text + Tables + Images         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Content Extraction                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent extracts text content from document:             â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Text Extraction Results                 â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ Total words: ~15,000                    â”‚            â”‚
â”‚  â”‚ Paragraphs: 120                         â”‚            â”‚
â”‚  â”‚ Sections: 8                             â”‚            â”‚
â”‚  â”‚ Tables: 5                               â”‚            â”‚
â”‚  â”‚ Images: 12                              â”‚            â”‚
â”‚  â”‚                                          â”‚            â”‚
â”‚  â”‚ Sections Identified:                    â”‚            â”‚
â”‚  â”‚ 1. Executive Summary                    â”‚            â”‚
â”‚  â”‚ 2. Market Analysis                      â”‚            â”‚
â”‚  â”‚ 3. Strategic Objectives                 â”‚            â”‚
â”‚  â”‚ 4. Financial Projections                â”‚            â”‚
â”‚  â”‚ 5. Product Roadmap                      â”‚            â”‚
â”‚  â”‚ 6. Go-to-Market Strategy                â”‚            â”‚
â”‚  â”‚ 7. Risk Assessment                      â”‚            â”‚
â”‚  â”‚ 8. Conclusion & Next Steps              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: AI Summarization                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Processing with GPT-4o:                                â”‚
â”‚                                                           â”‚
â”‚  â³ Analyzing document structure...                      â”‚
â”‚  â³ Extracting key points...                             â”‚
â”‚  â³ Generating executive summary...                      â”‚
â”‚  â³ Identifying action items...                          â”‚
â”‚  âœ“ Summary complete (2.5 seconds)                        â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Present Summary                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“„ Document Summary                              â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Q4-Strategic-Planning-Draft.docx                 â•‘  â”‚
â”‚  â•‘  35 pages â€¢ Last edited Oct 28, 2025              â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“Œ EXECUTIVE SUMMARY                             â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  This Q4 strategic planning document outlines     â•‘  â”‚
â”‚  â•‘  the company's priorities for the final quarter   â•‘  â”‚
â”‚  â•‘  of 2025. Key focus areas include:                â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â€¢ Expanding into European markets                â•‘  â”‚
â”‚  â•‘  â€¢ Launching two new product features             â•‘  â”‚
â”‚  â•‘  â€¢ Increasing revenue by 35% vs Q3                â•‘  â”‚
â”‚  â•‘  â€¢ Hiring 15 additional team members              â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ’° FINANCIAL HIGHLIGHTS                          â•‘  â”‚
â”‚  â•‘  â€¢ Projected Revenue: $12.5M                      â•‘  â”‚
â”‚  â•‘  â€¢ Budget Allocation: $4.2M                       â•‘  â”‚
â”‚  â•‘  â€¢ Expected Profit Margin: 42%                    â•‘  â”‚
â”‚  â•‘  â€¢ Customer Growth Target: 250 new customers      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ¯ KEY OBJECTIVES (Top 5)                        â•‘  â”‚
â”‚  â•‘  1. Launch European sales operations (Dec 1)      â•‘  â”‚
â”‚  â•‘  2. Release Advanced Analytics feature (Nov 15)   â•‘  â”‚
â”‚  â•‘  3. Complete SAP integration (Dec 15)             â•‘  â”‚
â”‚  â•‘  4. Achieve 95% customer satisfaction score       â•‘  â”‚
â”‚  â•‘  5. Secure 3 enterprise partnerships              â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸš€ PRODUCT ROADMAP                               â•‘  â”‚
â”‚  â•‘  â€¢ Advanced Reporting Dashboard (Nov 15)          â•‘  â”‚
â”‚  â•‘  â€¢ Mobile App iOS/Android (Dec 1)                 â•‘  â”‚
â”‚  â•‘  â€¢ API v2.0 Release (Dec 20)                      â•‘  â”‚
â”‚  â•‘  â€¢ Enterprise Security Features (Q1 2026)         â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  âš ï¸ RISKS & MITIGATION                            â•‘  â”‚
â”‚  â•‘  â€¢ Market Competition: Focus on differentiation   â•‘  â”‚
â”‚  â•‘  â€¢ Resource Constraints: Prioritize hiring        â•‘  â”‚
â”‚  â•‘  â€¢ Technical Complexity: Incremental rollout      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  âœ… ACTION ITEMS (8 identified)                   â•‘  â”‚
â”‚  â•‘  1. Finalize European market research by Nov 10   â•‘  â”‚
â”‚  â•‘  2. Complete product demo for enterprise clients  â•‘  â”‚
â”‚  â•‘  3. Hire European sales director by Nov 20        â•‘  â”‚
â”‚  â•‘  4. Set up EU data center infrastructure          â•‘  â”‚
â”‚  â•‘  5. Review and approve Q4 marketing budget        â•‘  â”‚
â”‚  â•‘  6. Schedule stakeholder review meeting           â•‘  â”‚
â”‚  â•‘  7. Update investor presentation deck             â•‘  â”‚
â”‚  â•‘  8. Prepare board meeting materials               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [View Full Document] [Export Summary]            â•‘  â”‚
â”‚  â•‘  [Create Tasks from Action Items]                 â•‘  â”‚
â”‚  â•‘  [Schedule Review Meeting]                        â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Create Tasks from Action Items"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Action Item Conversion                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent creates tasks in Microsoft Planner/To Do:        â”‚
â”‚                                                           â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  âœ… Creating Tasks                                â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  I'm creating 8 tasks from the action items:      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  âœ“ Task 1: Finalize European market research     â•‘  â”‚
â”‚  â•‘    Due: Nov 10, 2025                              â•‘  â”‚
â”‚  â•‘    Assigned to: You                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  âœ“ Task 2: Complete product demo                 â•‘  â”‚
â”‚  â•‘    Due: Nov 12, 2025                              â•‘  â”‚
â”‚  â•‘    Assigned to: You                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â³ Creating remaining 6 tasks...                 â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  All tasks created successfully!                  â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [View Tasks in Planner] [Add to Calendar]        â•‘  â”‚
â”‚  â•‘  [Dismiss]                                        â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/document-summarizer.service.ts
@Injectable()
export class DocumentSummarizerService {
  async summarizeDocument(
    fileId: string,
    context: McpContext,
  ): Promise<DocumentSummary> {
    // 1. Download document content
    const fileContent = await this.graphService.getFileContent(
      context.userToken,
      fileId,
    );

    // 2. Extract text (handle Word, PDF, etc.)
    const extractedText = await this.extractTextFromDocument(
      fileContent,
      fileContent.mimeType,
    );

    // 3. Analyze document structure
    const structure = this.analyzeDocumentStructure(extractedText);

    // 4. Generate summary using GPT-4o
    const summary = await this.generateSummary(extractedText, structure);

    // 5. Extract action items
    const actionItems = await this.extractActionItems(extractedText);

    return {
      summary,
      structure,
      actionItems,
      metadata: {
        pageCount: structure.sections.length,
        wordCount: extractedText.split(/\s+/).length,
        readingTime: Math.ceil(extractedText.split(/\s+/).length / 200), // words per minute
      },
    };
  }

  private async generateSummary(
    text: string,
    structure: DocumentStructure,
  ): Promise<string> {
    const prompt = `
      Analyze and summarize this document:

      Document Structure:
      ${JSON.stringify(structure, null, 2)}

      Content:
      ${text}

      Generate a comprehensive summary including:
      1. Executive summary (2-3 sentences)
      2. Key points (5-7 bullet points)
      3. Financial highlights (if any)
      4. Main objectives/goals
      5. Risks and mitigation strategies
      6. Timeline/milestones

      Format as JSON with sections.
    `;

    const response = await this.openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [{ role: 'user', content: prompt }],
      response_format: { type: 'json_object' },
      max_tokens: 2000,
    });

    return JSON.parse(response.choices[0].message.content);
  }

  private async extractActionItems(text: string): Promise<ActionItem[]> {
    const prompt = `
      Extract all action items from this document.
      Look for tasks, todos, deliverables, and commitments.

      Document:
      ${text}

      Return JSON array of action items with:
      - description: What needs to be done
      - dueDate: When it's due (if mentioned)
      - priority: high/medium/low
      - assignee: Who is responsible (if mentioned)
    `;

    const response = await this.openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [{ role: 'user', content: prompt }],
      response_format: { type: 'json_object' },
    });

    return JSON.parse(response.choices[0].message.content).actionItems;
  }
}
```

---

## Meeting Summary Flows

### Flow 6.1: Post-Meeting Summary Generation

**Objective:** Automatically generate meeting summaries and action items after meetings end.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   System    â”‚
â”‚  detects    â”‚
â”‚meeting end  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Meeting ends
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Meeting Completion Detection                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Calendar event webhook notification:                   â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Event: Meeting ended                    â”‚            â”‚
â”‚  â”‚ Meeting: Client Demo - Acme Corp        â”‚            â”‚
â”‚  â”‚ Duration: 11:00 AM - 12:05 PM (65 min)  â”‚            â”‚
â”‚  â”‚ Attendees: 5 people                     â”‚            â”‚
â”‚  â”‚ Recording available: Yes                 â”‚            â”‚
â”‚  â”‚ Transcript available: Yes                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â”‚  Trigger: Post-meeting summary workflow                 â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Meeting Content Retrieval                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent retrieves meeting artifacts:                     â”‚
â”‚                                                           â”‚
â”‚  1. Meeting Transcript:                                  â”‚
â”‚     Tool: get_meeting_transcript                         â”‚
â”‚     Source: Microsoft Teams                              â”‚
â”‚     Status: âœ“ Retrieved (15,000 words)                   â”‚
â”‚                                                           â”‚
â”‚  2. Chat Messages:                                       â”‚
â”‚     Tool: get_meeting_chat                               â”‚
â”‚     Status: âœ“ Retrieved (25 messages)                    â”‚
â”‚                                                           â”‚
â”‚  3. Shared Files:                                        â”‚
â”‚     Tool: get_meeting_files                              â”‚
â”‚     Status: âœ“ Retrieved (3 files)                        â”‚
â”‚     - Demo-Presentation.pptx                             â”‚
â”‚     - Q4-Pricing-Sheet.xlsx                              â”‚
â”‚     - Integration-Requirements.pdf                       â”‚
â”‚                                                           â”‚
â”‚  4. Recording:                                           â”‚
â”‚     Status: âœ“ Available                                  â”‚
â”‚     Link: https://teams.microsoft.com/...                â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: AI Analysis                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  GPT-4o analyzes transcript and chat:                   â”‚
â”‚                                                         â”‚
â”‚  â³ Identifying key discussion points...                â”‚
â”‚  â³ Extracting decisions made...                        â”‚
â”‚  â³ Finding action items...                             â”‚
â”‚  â³ Detecting follow-up questions...                    â”‚
â”‚  â³ Analyzing sentiment and engagement...               â”‚
â”‚  âœ“ Analysis complete (8 seconds)                        â”‚
â”‚                                                         â”‚
â”‚  Analysis Results:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Key Topics: 5 identified                â”‚            â”‚
â”‚  â”‚ Decisions Made: 3 identified            â”‚            â”‚
â”‚  â”‚ Action Items: 7 identified              â”‚            â”‚
â”‚  â”‚ Follow-ups Needed: 4 identified         â”‚            â”‚
â”‚  â”‚ Sentiment: Positive (0.85)              â”‚            â”‚
â”‚  â”‚ Engagement Level: High                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Summary Generation                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent compiles comprehensive meeting summary:          â”‚
â”‚                                                           â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“ Meeting Summary                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Client Demo - Acme Corp                          â•‘  â”‚
â”‚  â•‘  November 3, 2025 â€¢ 11:00 AM - 12:05 PM           â•‘  â”‚
â”‚  â•‘  Duration: 1 hour 5 minutes                       â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ‘¥ PARTICIPANTS (5)                               â•‘  â”‚
â”‚  â•‘  â€¢ John Doe (You) - Host                          â•‘  â”‚
â”‚  â•‘  â€¢ Jane Smith - Acme Corp CEO                     â•‘  â”‚
â”‚  â•‘  â€¢ Bob Wilson - Acme Corp CTO                     â•‘  â”‚
â”‚  â•‘  â€¢ Sarah Johnson - Finance Lead                   â•‘  â”‚
â”‚  â•‘  â€¢ Mike Williams - Product Manager                â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“‹ MEETING OVERVIEW                              â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Product demonstration for Acme Corp focused on   â•‘  â”‚
â”‚  â•‘  enterprise features, SAP integration, and        â•‘  â”‚
â”‚  â•‘  reporting capabilities. Overall positive         â•‘  â”‚
â”‚  â•‘  reception with strong interest in moving forward.â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ¯ KEY DISCUSSION POINTS                         â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  1. SAP Integration                               â•‘  â”‚
â”‚  â•‘     - Demonstrated real-time data sync            â•‘  â”‚
â”‚  â•‘     - Bob confirmed this meets their requirements â•‘  â”‚
â”‚  â•‘     - Discussed implementation timeline (8 weeks) â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  2. Advanced Reporting Dashboard                  â•‘  â”‚
â”‚  â•‘     - Showcased custom report builder             â•‘  â”‚
â”‚  â•‘     - Jane particularly interested in exec dashbdâ•‘  â”‚
â”‚  â•‘     - Requested sample reports for review         â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  3. Pricing & Licensing                           â•‘  â”‚
â”‚  â•‘     - Presented enterprise pricing tier           â•‘  â”‚
â”‚  â•‘     - Discussed volume discounts for 500 users    â•‘  â”‚
â”‚  â•‘     - Sarah to review with finance team           â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  4. Implementation & Support                      â•‘  â”‚
â”‚  â•‘     - Timeline: 8-12 weeks full deployment        â•‘  â”‚
â”‚  â•‘     - Dedicated account manager included          â•‘  â”‚
â”‚  â•‘     - 24/7 support for enterprise tier            â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  5. Compliance & Security                         â•‘  â”‚
â”‚  â•‘     - GDPR compliance confirmed                   â•‘  â”‚
â”‚  â•‘     - SOC 2 Type II certification shared          â•‘  â”‚
â”‚  â•‘     - Bob satisfied with security architecture    â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  âœ… DECISIONS MADE                                â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  1. Acme Corp will proceed with pilot program     â•‘  â”‚
â”‚  â•‘     starting with one manufacturing facility      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  2. Enterprise tier selected (500 user licenses)  â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  3. Target go-live date: February 1, 2026         â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“Œ ACTION ITEMS                                   â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [John Doe]                                       â•‘  â”‚
â”‚  â•‘  â€¢ Send sample executive dashboard reports        â•‘  â”‚
â”‚  â•‘    Due: Nov 5, 2025                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â€¢ Prepare detailed implementation plan           â•‘  â”‚
â”‚  â•‘    Due: Nov 8, 2025                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â€¢ Schedule technical deep-dive with Bob          â•‘  â”‚
â”‚  â•‘    Due: Next week                                 â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [Sarah Johnson]                                  â•‘  â”‚
â”‚  â•‘  â€¢ Finalize pricing proposal with volume discountâ•‘  â”‚
â”‚  â•‘    Due: Nov 6, 2025                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [Mike Williams]                                  â•‘  â”‚
â”‚  â•‘  â€¢ Create pilot program timeline                  â•‘  â”‚
â”‚  â•‘    Due: Nov 7, 2025                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â€¢ Set up demo environment for Acme pilot         â•‘  â”‚
â”‚  â•‘    Due: Nov 10, 2025                              â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [Acme Corp Team]                                 â•‘  â”‚
â”‚  â•‘  â€¢ Jane: Review pricing with board                â•‘  â”‚
â”‚  â•‘    Due: Nov 12, 2025                              â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â“ FOLLOW-UP QUESTIONS                            â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â€¢ Can we customize the dashboard color scheme?   â•‘  â”‚
â”‚  â•‘  â€¢ What's the data retention policy?              â•‘  â”‚
â”‚  â•‘  â€¢ Are there any additional costs for EU hosting? â•‘  â”‚
â”‚  â•‘  â€¢ Can we integrate with Salesforce as well?      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“ ATTACHMENTS & RESOURCES                        â•‘  â”‚
â”‚  â•‘  â€¢ Demo-Presentation.pptx                         â•‘  â”‚
â”‚  â•‘  â€¢ Q4-Pricing-Sheet.xlsx                          â•‘  â”‚
â”‚  â•‘  â€¢ Integration-Requirements.pdf                   â•‘  â”‚
â”‚  â•‘  â€¢ Meeting Recording (65 minutes)                 â•‘  â”‚
â”‚  â•‘  â€¢ Full Transcript                                â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ­ SENTIMENT ANALYSIS                            â•‘  â”‚
â”‚  â•‘  Overall: Positive (85%)                          â•‘  â”‚
â”‚  â•‘  â€¢ Jane Smith: Very Positive                      â•‘  â”‚
â”‚  â•‘  â€¢ Bob Wilson: Positive                           â•‘  â”‚
â”‚  â•‘  â€¢ Engagement Level: High                         â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ’¡ NEXT STEPS                                     â•‘  â”‚
â”‚  â•‘  1. Schedule follow-up meeting for Nov 15         â•‘  â”‚
â”‚  â•‘  2. Send proposal document by Nov 8               â•‘  â”‚
â”‚  â•‘  3. Initiate contract preparation                 â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [Email Summary] [Create Tasks] [Schedule Follow-up]â•‘
â”‚  â•‘  [Share with Team] [Download PDF]                 â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Auto-distribute
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Distribution & Task Creation                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent automatically:                                    â”‚
â”‚                                                           â”‚
â”‚  1. Email summary to all participants                    â”‚
â”‚     âœ“ Sent to 5 attendees                                â”‚
â”‚                                                           â”‚
â”‚  2. Create tasks in Planner/To Do                        â”‚
â”‚     âœ“ Created 7 tasks with due dates and assignments    â”‚
â”‚                                                           â”‚
â”‚  3. Save summary to SharePoint                           â”‚
â”‚     âœ“ Saved to "Meeting Notes" folder                    â”‚
â”‚                                                           â”‚
â”‚  4. Add to knowledge base                                â”‚
â”‚     âœ“ Indexed in ChromaDB for future reference          â”‚
â”‚                                                           â”‚
â”‚  5. Schedule follow-up meeting                           â”‚
â”‚     âœ“ Tentative meeting scheduled for Nov 15            â”‚
â”‚                                                           â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  âœ… Meeting summary complete and distributed!     â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  All attendees have been emailed the summary.     â•‘  â”‚
â”‚  â•‘  Action items have been created and assigned.     â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [View Summary] [View Tasks] [Dismiss]            â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/meeting-summarizer.service.ts
@Injectable()
export class MeetingSummarizerService {
  @OnEvent('meeting.ended')
  async handleMeetingEnded(event: MeetingEndedEvent): Promise<void> {
    try {
      // 1. Retrieve meeting artifacts
      const artifacts = await this.retrieveMeetingArtifacts(event.meetingId);

      // 2. Generate summary
      const summary = await this.generateMeetingSummary(artifacts);

      // 3. Distribute summary
      await this.distributeSummary(event.meetingId, summary);

      // 4. Create tasks from action items
      await this.createTasksFromActionItems(summary.actionItems);

      // 5. Save to knowledge base
      await this.saveToKnowledgeBase(summary);

    } catch (error) {
      this.logger.error('Error processing meeting summary', error);
    }
  }

  private async retrieveMeetingArtifacts(
    meetingId: string,
  ): Promise<MeetingArtifacts> {
    const meeting = await this.graphService.getCalendarEvent(userToken, meetingId);

    const [transcript, chatMessages, files, recording] = await Promise.all([
      this.graphService.getMeetingTranscript(userToken, meetingId),
      this.graphService.getMeetingChat(userToken, meetingId),
      this.graphService.getMeetingFiles(userToken, meetingId),
      this.graphService.getMeetingRecording(userToken, meetingId),
    ]);

    return {
      meeting,
      transcript,
      chatMessages,
      files,
      recording,
    };
  }

  private async generateMeetingSummary(
    artifacts: MeetingArtifacts,
  ): Promise<MeetingSummary> {
    const prompt = `
      Analyze this meeting and generate a comprehensive summary:

      Meeting: ${JSON.stringify(artifacts.meeting)}
      Transcript: ${artifacts.transcript}
      Chat Messages: ${JSON.stringify(artifacts.chatMessages)}
      Files Shared: ${JSON.stringify(artifacts.files)}

      Generate a detailed summary including:
      1. Meeting overview (2-3 sentences)
      2. Key discussion points (5-7 major topics)
      3. Decisions made (list all)
      4. Action items with assignees and due dates
      5. Follow-up questions
      6. Sentiment analysis
      7. Next steps

      Format as JSON.
    `;

    const response = await this.openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [{ role: 'user', content: prompt }],
      response_format: { type: 'json_object' },
      max_tokens: 4000,
    });

    return JSON.parse(response.choices[0].message.content);
  }

  private async distributeSummary(
    meetingId: string,
    summary: MeetingSummary,
  ): Promise<void> {
    const meeting = await this.graphService.getCalendarEvent(userToken, meetingId);
    const attendees = meeting.attendees.map(a => a.emailAddress.address);

    // Email summary to all attendees
    await this.graphService.sendEmail(userToken, {
      recipients: attendees,
      subject: `Meeting Summary: ${meeting.subject}`,
      body: this.formatSummaryAsEmail(summary),
      attachments: [{
        name: 'Meeting-Summary.pdf',
        content: await this.generatePDF(summary),
      }],
    });

    // Post to Teams channel if applicable
    if (meeting.teamsChannelId) {
      await this.teamsService.postMessage(
        meeting.teamsChannelId,
        this.formatSummaryAsCard(summary),
      );
    }

    // Save to SharePoint
    await this.graphService.createFile({
      name: `Meeting-Summary-${new Date().toISOString()}.md`,
      content: this.formatSummaryAsMarkdown(summary),
      folder: 'Meeting Notes',
    });
  }

  private async createTasksFromActionItems(
    actionItems: ActionItem[],
  ): Promise<void> {
    for (const item of actionItems) {
      await this.graphService.createTask({
        title: item.description,
        dueDateTime: item.dueDate,
        assignedTo: item.assignee,
        priority: item.priority,
        notes: `From meeting: ${item.meetingTitle}`,
      });
    }
  }
}
```

---

## Knowledge Base Interaction Flows

### Flow 7.1: Knowledge Base Query

**Objective:** Allow users to query the organizational knowledge base for information.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚   asks      â”‚
â”‚  question   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "What's our company policy on remote work?"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Query Analysis                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent analyzes user query:                             â”‚
â”‚                                                           â”‚
â”‚  Raw Input: "What's our company policy on remote work?" â”‚
â”‚                                                           â”‚
â”‚  Query Classification:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Type: Policy Question                   â”‚            â”‚
â”‚  â”‚ Intent: Information Retrieval           â”‚            â”‚
â”‚  â”‚ Category: HR/Workplace Policy           â”‚            â”‚
â”‚  â”‚ Keywords: ["company policy", "remote    â”‚            â”‚
â”‚  â”‚            work", "work from home"]     â”‚            â”‚
â”‚  â”‚ Expected Answer: Policy document        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Knowledge Base Search                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Tool: search_knowledge_base                             â”‚
â”‚  Backend: ChromaDB vector search                         â”‚
â”‚                                                           â”‚
â”‚  Vector Embedding:                                       â”‚
â”‚  1. Convert query to embeddings using text-embedding-3  â”‚
â”‚  2. Search ChromaDB collection "company_policies"        â”‚
â”‚  3. Return top 5 most similar chunks                     â”‚
â”‚                                                           â”‚
â”‚  Search Results:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Result 1: Remote Work Policy v2.1          â”‚         â”‚
â”‚  â”‚   Similarity: 0.94                         â”‚         â”‚
â”‚  â”‚   Source: HR-Handbook-2025.pdf, pg 42      â”‚         â”‚
â”‚  â”‚   Updated: September 2025                  â”‚         â”‚
â”‚  â”‚   Chunk: "Employees may work remotely..."  â”‚         â”‚
â”‚  â”‚                                             â”‚         â”‚
â”‚  â”‚ Result 2: Hybrid Work Guidelines           â”‚         â”‚
â”‚  â”‚   Similarity: 0.88                         â”‚         â”‚
â”‚  â”‚   Source: HR-Updates-Q3.docx               â”‚         â”‚
â”‚  â”‚   Updated: July 2025                       â”‚         â”‚
â”‚  â”‚   Chunk: "Hybrid work arrangements..."     â”‚         â”‚
â”‚  â”‚                                             â”‚         â”‚
â”‚  â”‚ Result 3: Home Office Equipment Policy     â”‚         â”‚
â”‚  â”‚   Similarity: 0.82                         â”‚         â”‚
â”‚  â”‚   Source: IT-Policies.pdf, pg 15           â”‚         â”‚
â”‚  â”‚   Chunk: "Equipment for remote work..."    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Answer Synthesis                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent synthesizes answer from multiple sources:        â”‚
â”‚                                                           â”‚
â”‚  GPT-4o processes:                                       â”‚
â”‚  â€¢ Top 3 search results                                  â”‚
â”‚  â€¢ Source documents metadata                             â”‚
â”‚  â€¢ Company context                                       â”‚
â”‚  â€¢ User's role and department                            â”‚
â”‚                                                           â”‚
â”‚  â³ Generating comprehensive answer...                   â”‚
â”‚  âœ“ Answer generated (1.2 seconds)                        â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Present Answer                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“š Remote Work Policy                            â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Based on company policy documents:               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“ POLICY OVERVIEW                               â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Employees may work remotely up to 3 days per     â•‘  â”‚
â”‚  â•‘  week with manager approval. Full-time remote     â•‘  â”‚
â”‚  â•‘  work requires VP-level approval.                 â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  âœ… REQUIREMENTS                                   â•‘  â”‚
â”‚  â•‘  â€¢ Reliable high-speed internet (25+ Mbps)        â•‘  â”‚
â”‚  â•‘  â€¢ Dedicated workspace at home                    â•‘  â”‚
â”‚  â•‘  â€¢ Available during core hours (10 AM - 3 PM)     â•‘  â”‚
â”‚  â•‘  â€¢ Company-provided laptop and equipment          â•‘  â”‚
â”‚  â•‘  â€¢ VPN access configured                          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“‹ ELIGIBILITY                                    â•‘  â”‚
â”‚  â•‘  â€¢ Completed probation period (6 months)          â•‘  â”‚
â”‚  â•‘  â€¢ Good performance rating (meets expectations+)  â•‘  â”‚
â”‚  â•‘  â€¢ Role suitable for remote work                  â•‘  â”‚
â”‚  â•‘  â€¢ Manager approval obtained                      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ¢ OFFICE DAYS                                    â•‘  â”‚
â”‚  â•‘  â€¢ Minimum 2 days/week in office                  â•‘  â”‚
â”‚  â•‘  â€¢ Team meeting days (usually Tuesdays)           â•‘  â”‚
â”‚  â•‘  â€¢ Important client meetings                      â•‘  â”‚
â”‚  â•‘  â€¢ Company events and all-hands meetings          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ’» EQUIPMENT & SUPPORT                            â•‘  â”‚
â”‚  â•‘  â€¢ Company laptop provided                        â•‘  â”‚
â”‚  â•‘  â€¢ Monitor, keyboard, mouse available on request  â•‘  â”‚
â”‚  â•‘  â€¢ $500 annual home office stipend                â•‘  â”‚
â”‚  â•‘  â€¢ IT support via Teams/email                     â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â“ SPECIAL CASES                                  â•‘  â”‚
â”‚  â•‘  â€¢ International remote work: Requires legal      â•‘  â”‚
â”‚  â•‘    review and VP approval                         â•‘  â”‚
â”‚  â•‘  â€¢ Medical accommodations: Contact HR directly    â•‘  â”‚
â”‚  â•‘  â€¢ Temporary arrangements: Manager discretion     â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ“„ SOURCE DOCUMENTS                               â•‘  â”‚
â”‚  â•‘  â€¢ Remote Work Policy v2.1 (HR Handbook pg 42)    â•‘  â”‚
â”‚  â•‘    [View Document]                                â•‘  â”‚
â”‚  â•‘  â€¢ Hybrid Work Guidelines (Q3 2025 Update)        â•‘  â”‚
â”‚  â•‘    [View Document]                                â•‘  â”‚
â”‚  â•‘  â€¢ Home Office Equipment Policy (IT Policies)     â•‘  â”‚
â”‚  â•‘    [View Document]                                â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  ğŸ’¡ NEXT STEPS                                     â•‘  â”‚
â”‚  â•‘  Want to start working remotely?                  â•‘  â”‚
â”‚  â•‘  1. Discuss with your manager                     â•‘  â”‚
â”‚  â•‘  2. Complete Remote Work Agreement form           â•‘  â”‚
â”‚  â•‘  3. Submit through HR portal                      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [Request Remote Work] [Contact HR]               â•‘  â”‚
â”‚  â•‘  [View Full Policy] [Ask Follow-up]               â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User clicks "Request Remote Work"
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Guided Action                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Agent guides user through process:                     â”‚
â”‚                                                           â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ“ Remote Work Request                           â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  I'll help you submit a remote work request.      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Let me check your eligibility:                   â•‘  â”‚
â”‚  â•‘  âœ“ Probation period: Completed (hired Jan 2024)   â•‘  â”‚
â”‚  â•‘  âœ“ Performance rating: Exceeds expectations       â•‘  â”‚
â”‚  â•‘  âœ“ Role suitability: Yes (desk-based role)        â•‘  â”‚
â”‚  â•‘  â³ Manager approval: Pending                      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  Great! You're eligible. Here's what I need:      â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  1. How many days per week would you like to      â•‘  â”‚
â”‚  â•‘     work remotely?                                â•‘  â”‚
â”‚  â•‘     [1 day] [2 days] [3 days] [Custom]            â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  2. Which days?                                   â•‘  â”‚
â”‚  â•‘     [Mon] [Tue] [Wed] [Thu] [Fri]                 â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  3. Reason for request (optional):                â•‘  â”‚
â”‚  â•‘     [Text input]                                  â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  I'll draft an email to your manager and prepare  â•‘  â”‚
â”‚  â•‘  the HR form for you.                             â•‘  â”‚
â”‚  â•‘                                                    â•‘  â”‚
â”‚  â•‘  [Continue] [Cancel]                              â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/agents/knowledge-base.service.ts
@Injectable()
export class KnowledgeBaseService {
  constructor(
    private chromaService: ChromaService,
    private openaiService: OpenAIService,
  ) {}

  async queryKnowledgeBase(
    query: string,
    context: McpContext,
  ): Promise<KnowledgeBaseResult> {
    // 1. Classify query
    const classification = await this.classifyQuery(query);

    // 2. Generate embeddings
    const queryEmbedding = await this.openaiService.createEmbedding(query);

    // 3. Search ChromaDB
    const searchResults = await this.chromaService.query({
      collectionName: this.getCollectionForCategory(classification.category),
      queryEmbeddings: [queryEmbedding],
      nResults: 5,
    });

    // 4. Synthesize answer
    const answer = await this.synthesizeAnswer(query, searchResults);

    // 5. Return formatted result
    return {
      answer,
      sources: searchResults.documents[0].map((doc, idx) => ({
        content: doc,
        metadata: searchResults.metadatas[0][idx],
        similarity: searchResults.distances[0][idx],
      })),
      confidence: this.calculateConfidence(searchResults),
    };
  }

  private async synthesizeAnswer(
    query: string,
    searchResults: ChromaQueryResult,
  ): Promise<string> {
    const context = searchResults.documents[0].join('\n\n---\n\n');

    const prompt = `
      Answer this question based on the provided context:

      Question: ${query}

      Context from knowledge base:
      ${context}

      Provide a comprehensive, well-structured answer that:
      1. Directly answers the question
      2. Cites relevant sources
      3. Includes practical next steps if applicable
      4. Uses clear formatting (bullet points, sections)

      If the context doesn't contain enough information, say so.
    `;

    const response = await this.openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [{ role: 'user', content: prompt }],
      temperature: 0.7,
    });

    return response.choices[0].message.content;
  }

  private calculateConfidence(results: ChromaQueryResult): number {
    // Calculate confidence based on similarity scores
    const distances = results.distances[0];
    if (distances.length === 0) return 0;

    // Lower distance = higher similarity = higher confidence
    const avgDistance = distances.reduce((a, b) => a + b, 0) / distances.length;

    // Convert to 0-1 confidence score (inverse of distance)
    return Math.max(0, Math.min(1, 1 - avgDistance));
  }
}
```

---

## Workflow Automation Flows

### Flow 8.1: Multi-Step Workflow Execution

**Objective:** Execute complex multi-agent workflows for automated tasks.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  triggers   â”‚
â”‚  workflow   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Run my daily briefing workflow"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Workflow Identification                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Tool: start_workflow                                   â”‚
â”‚  Params: {                                              â”‚
â”‚    workflowName: "daily_briefing",                      â”‚
â”‚    userId: "user-123"                                   â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  Workflow Definition Retrieved:                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Name: daily_briefing                    â”‚            â”‚
â”‚  â”‚ Description: Comprehensive daily update â”‚            â”‚
â”‚  â”‚ Stages: 5                                â”‚           â”‚
â”‚  â”‚ Estimated Duration: 2-3 minutes          â”‚           â”‚
â”‚  â”‚ Agents Involved: 3                       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Workflow Initialization                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  WorkflowOrchestratorService creates workflow run:      â”‚
â”‚                                                         â”‚
â”‚  Database Record:                                       â”‚
â”‚  {                                                      â”‚
â”‚    id: "workflow-run-456",                              â”‚
â”‚    workflowName: "daily_briefing",                      â”‚
â”‚    userId: "user-123",                                  â”‚
â”‚    status: "PENDING",                                   â”‚
â”‚    currentStage: null,                                  â”‚
â”‚    stages: [                                            â”‚
â”‚      "fetch_emails",                                    â”‚
â”‚      "fetch_calendar",                                  â”‚
â”‚      "fetch_tasks",                                     â”‚
â”‚      "generate_insights",                               â”‚
â”‚      "send_briefing"                                    â”‚
â”‚    ],                                                   â”‚
â”‚    createdAt: "2025-11-03T09:00:00Z"                    â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘  ğŸ”„ Starting Workflow: Daily Briefing             â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  This will take 2-3 minutes.                      â•‘  â”‚
â”‚  â•‘  I'll notify you when it's complete.              â•‘  â”‚
â”‚  â•‘                                                   â•‘  â”‚
â”‚  â•‘  [View Progress] [Cancel Workflow]                â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Stage-by-Stage Execution                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Stage 1: fetch_emails                  â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ Agent: email-agent                     â”‚             â”‚
â”‚  â”‚ Tool: search_emails                    â”‚             â”‚
â”‚  â”‚ Input: {                               â”‚             â”‚
â”‚  â”‚   query: "unread",                     â”‚             â”‚
â”‚  â”‚   maxResults: 20,                      â”‚             â”‚
â”‚  â”‚   dateRange: "last 24 hours"           â”‚             â”‚
â”‚  â”‚ }                                      â”‚             â”‚
â”‚  â”‚ Status: âœ“ Complete (180ms)             â”‚             â”‚
â”‚  â”‚ Output: 8 unread emails                â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Stage 2: fetch_calendar                â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ Agent: calendar-agent                  â”‚             â”‚
â”‚  â”‚ Tool: get_calendar_events              â”‚             â”‚
â”‚  â”‚ Input: {                               â”‚             â”‚
â”‚  â”‚   startDate: "2025-11-03",             â”‚             â”‚
â”‚  â”‚   endDate: "2025-11-03"                â”‚             â”‚
â”‚  â”‚ }                                      â”‚             â”‚
â”‚  â”‚ Status: âœ“ Complete (250ms)             â”‚             â”‚
â”‚  â”‚ Output: 3 meetings today               â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Stage 3: fetch_tasks                    â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ Agent: task-agent                       â”‚            â”‚
â”‚  â”‚ Tool: get_user_tasks                    â”‚            â”‚
â”‚  â”‚ Input: {                                â”‚            â”‚
â”‚  â”‚   filter: "due:today OR overdue"        â”‚            â”‚
â”‚  â”‚ }                                       â”‚            â”‚
â”‚  â”‚ Status: âœ“ Complete (150ms)              â”‚            â”‚
â”‚  â”‚ Output: 5 tasks (2 due today, 3 overdue)â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Stage 4: generate_insights             â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ Agent: insights-agent                  â”‚             â”‚
â”‚  â”‚ Tool: analyze_workload                 â”‚             â”‚
â”‚  â”‚ Input: {                               â”‚             â”‚
â”‚  â”‚   emails: [stage1 output],             â”‚             â”‚
â”‚  â”‚   calendar: [stage2 output],           â”‚             â”‚
â”‚  â”‚   tasks: [stage3 output]               â”‚             â”‚
â”‚  â”‚ }                                      â”‚             â”‚
â”‚  â”‚ Status: âœ“ Complete (1200ms)            â”‚             â”‚
â”‚  â”‚ Output: 4 insights generated           â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Stage 5: send_briefing                 â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ Agent: notification-agent              â”‚             â”‚
â”‚  â”‚ Tool: send_teams_message               â”‚             â”‚
â”‚  â”‚ Input: {                               â”‚             â”‚
â”‚  â”‚   userId: "user-123",                  â”‚             â”‚
â”‚  â”‚   content: [formatted briefing]        â”‚             â”‚
â”‚  â”‚ }                                      â”‚             â”‚
â”‚  â”‚ Status: âœ“ Complete (320ms)             â”‚             â”‚
â”‚  â”‚ Output: Briefing sent to user          â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                         â”‚
â”‚  Total Workflow Time: 2.1 seconds                       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Workflow Completion                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Update database:                                       â”‚
â”‚  {                                                      â”‚
â”‚    id: "workflow-run-456",                              â”‚
â”‚    status: "COMPLETED",                                 â”‚
â”‚    completedAt: "2025-11-03T09:00:02Z",                 â”‚
â”‚    result: {                                            â”‚
â”‚      emailCount: 8,                                     â”‚
â”‚      meetingCount: 3,                                   â”‚
â”‚      taskCount: 5,                                      â”‚
â”‚      insightsGenerated: 4                               â”‚
â”‚    }                                                    â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  User receives daily briefing (see Flow 2.1)            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling and Recovery Flows

### Flow 9.1: Token Expiration and Refresh

**Objective:** Gracefully handle expired authentication tokens.

**Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  makes      â”‚
â”‚  request    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Show me my emails"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Token Validation                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Backend checks user's Graph API token:                 â”‚
â”‚                                                         â”‚
â”‚  Token Status:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ accessToken: "eyJ0eXAi..."              â”‚            â”‚
â”‚  â”‚ expiresAt: "2025-11-03T08:00:00Z"       â”‚            â”‚
â”‚  â”‚ currentTime: "2025-11-03T09:30:00Z"     â”‚            â”‚
â”‚  â”‚ isExpired: TRUE                         â”‚            â”‚
â”‚  â”‚ refreshToken: "0.AXEA..."               â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  âŒ Token expired! Attempting automatic refresh...      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Automatic Token Refresh                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Backend calls Azure AD token endpoint:                 â”‚
â”‚                                                         â”‚
â”‚  POST https://login.microsoftonline.com/                â”‚
â”‚       {tenant}/oauth2/v2.0/token                        â”‚
â”‚                                                         â”‚
â”‚  Request:                                               â”‚
â”‚  {                                                      â”‚
â”‚    grant_type: "refresh_token",                         â”‚
â”‚    refresh_token: "0.AXEA...",                          â”‚
â”‚    client_id: "{MICROSOFT_APP_ID}",                     â”‚
â”‚    client_secret: "{MICROSOFT_APP_PASSWORD}",           â”‚
â”‚    scope: "User.Read Mail.Read Calendar.Read..."        â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  Response:                                              â”‚
â”‚  {                                                      â”‚
â”‚    access_token: "eyJ0eXAi... [new token]",             â”‚
â”‚    refresh_token: "0.AXEA... [new refresh token]",      â”‚
â”‚    expires_in: 3600                                     â”‚
â”‚  }                                                      â”‚
â”‚                                                         â”‚
â”‚  âœ“ Token refreshed successfully!                        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Update Stored Token                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Update agent mapping in database:                      â”‚
â”‚                                                         â”‚
â”‚  UPDATE agent_mappings                                  â”‚
â”‚  SET metadata = jsonb_set(                              â”‚
â”‚    metadata,                                            â”‚
â”‚    '{accessToken}',                                     â”‚
â”‚    '"eyJ0eXAi... [new token]"'                          â”‚
â”‚  )                                                      â”‚
â”‚  WHERE user_id = 'user-123';                            â”‚
â”‚                                                         â”‚
â”‚  âœ“ Token updated in database                            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Retry Original Request                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Retry original user request with new token:            â”‚
â”‚                                                         â”‚
â”‚  Tool: search_emails                                    â”‚
â”‚  Params: { query: "unread" }                            â”‚
â”‚  Context: { userToken: [new token] }                    â”‚
â”‚                                                         â”‚
â”‚  âœ“ Request successful!                                  â”‚
â”‚                                                         â”‚
â”‚  User receives email results (transparent to user)      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical Implementation:**

```typescript
// File: backend/src/auth/token-manager.service.ts
@Injectable()
export class TokenManagerService {
  async refreshToken(userId: string): Promise<string> {
    const agentMapping = await this.agentMappingRepository.findOne({
      where: { userId },
    });

    if (!agentMapping?.metadata?.refreshToken) {
      throw new Error('No refresh token available');
    }

    try {
      const tokenResponse = await axios.post(
        `https://login.microsoftonline.com/${process.env.AZURE_TENANT_ID}/oauth2/v2.0/token`,
        new URLSearchParams({
          grant_type: 'refresh_token',
          refresh_token: agentMapping.metadata.refreshToken,
          client_id: process.env.MICROSOFT_APP_ID,
          client_secret: process.env.MICROSOFT_APP_PASSWORD,
          scope: 'User.Read Mail.Read Calendar.Read Files.Read...',
        }),
      );

      // Update stored tokens
      agentMapping.metadata.accessToken = tokenResponse.data.access_token;
      agentMapping.metadata.refreshToken = tokenResponse.data.refresh_token;
      agentMapping.metadata.tokenExpiresAt = new Date(
        Date.now() + tokenResponse.data.expires_in * 1000,
      );

      await this.agentMappingRepository.save(agentMapping);

      return tokenResponse.data.access_token;
    } catch (error) {
      this.logger.error('Error refreshing token', error);
      throw new Error('Token refresh failed - user needs to re-authenticate');
    }
  }

  async getValidToken(userId: string): Promise<string> {
    const agentMapping = await this.agentMappingRepository.findOne({
      where: { userId },
    });

    if (!agentMapping?.metadata?.accessToken) {
      throw new Error('No token available');
    }

    const tokenExpiresAt = new Date(agentMapping.metadata.tokenExpiresAt);
    const now = new Date();

    // Check if token expires in next 5 minutes
    if (tokenExpiresAt.getTime() - now.getTime() < 5 * 60 * 1000) {
      this.logger.log('Token expiring soon, refreshing...');
      return await this.refreshToken(userId);
    }

    return agentMapping.metadata.accessToken;
  }
}

// Middleware to automatically handle token refresh
@Injectable()
export class GraphApiInterceptor implements NestInterceptor {
  constructor(private tokenManager: TokenManagerService) {}

  async intercept(
    context: ExecutionContext,
    next: CallHandler,
  ): Promise<Observable<any>> {
    const request = context.switchToHttp().getRequest();
    const userId = request.user?.id;

    if (userId) {
      try {
        // Ensure token is valid before proceeding
        request.graphToken = await this.tokenManager.getValidToken(userId);
      } catch (error) {
        throw new UnauthorizedException('Please re-authenticate');
      }
    }

    return next.handle().pipe(
      catchError(async (error) => {
        // If we get 401 from Graph API, try token refresh once
        if (error.response?.status === 401 && userId) {
          try {
            request.graphToken = await this.tokenManager.refreshToken(userId);
            // Retry the request
            return next.handle();
          } catch (refreshError) {
            throw new UnauthorizedException('Please re-authenticate');
          }
        }
        throw error;
      }),
    );
  }
}
```

---

## Conclusion

This document provides comprehensive user flow documentation for the Amaiko AI enterprise assistant application. Each flow demonstrates the interaction between users, the AI agent, and various Microsoft 365 services through the MCP tools layer.

**Key Takeaways:**

1. **Seamless Authentication**: OAuth 2.0 flows with automatic token refresh ensure uninterrupted service
2. **Multi-Agent Architecture**: Specialized agents collaborate to handle complex workflows
3. **Natural Language Understanding**: GPT-4o powers intent recognition and response generation
4. **Proactive Assistance**: System-initiated notifications and workflow automation
5. **Knowledge Base Integration**: ChromaDB vector search for organizational knowledge
6. **Error Resilience**: Graceful error handling with automatic recovery
7. **Context Awareness**: Agent memory systems maintain conversation continuity

**Files Referenced:**

- `/backend/src/agents/agent.service.ts` - Core agent logic
- `/backend/src/agents/agent-memory.service.ts` - Memory management
- `/backend/src/agents/workflow-orchestrator.service.ts` - Workflow execution
- `/backend/src/mcp/tools/email-tools.service.ts` - Email MCP tools
- `/backend/src/mcp/tools/calendar-tools.service.ts` - Calendar MCP tools
- `/backend/src/graph/graph.service.ts` - Microsoft Graph integration
- `/backend/src/agents/entities/agent-mapping.entity.ts` - User-agent mappings
- `/backend/src/agents/entities/workflow-run.entity.ts` - Workflow tracking

---

**Document Version:** 1.0
**Last Updated:** November 2025
**Maintainer:** Amaiko AI Development Team
